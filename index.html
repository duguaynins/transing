




<!DOCTYPE html>
<html lang="en">
<head translate="yes">
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" sizes="48x48" href="data:image/x-icon;base64,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">
    <!--link rel="icon" type="image/x-icon" sizes="48x48" href="https://duguaynins-allninsone.hf.space/favicon.ico"-->
    <!--link rel="icon" type="image/png" sizes="48x48" href="/favicon.png"-->
    <!--link rel="shortcut icon" href="/favicon.ico"-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="description" content="Â© 2024 NINS (by JPGT). By using any of the services, it means you have agreed to any content and all content!">
    <link rel="canonical" href="https://copyright.nins.cc/">
    <title translate="no">nins/transing</title>
    <!--title translate="no">ã“ã‚ŒãŒè‡ªç”±ã </title-->

    
    <script src="https://cdn.ably.io/lib/ably.min-1.js"></script>
    <!--link rel="stylesheet" href="style.css"-->
    <!--link rel="stylesheet" href="transing.css"-->
    <style>
      body {
        overflow: hidden;
      }
    </style>
    <style>
      iframe.VIpgJd-ZVi9od-ORHb-OEVmcd {
        /*display: none !important;*/
      }
      #skiptranslate {
        /*display: none;*/
      }
      input, textarea, button, select {
        /*font-size: inherit; /* ä¸»å‹•ç¹¼æ‰¿ body å­—é«”å¤§å° */
        font-size: 18px;
      }
      html, body { font-size: 14px; }
      html, body {
        background-color: #000000;
        margin: 0;
        padding: 0;
        height: 80vh;
        
        display: flex;
        flex-direction: column;
        
      }
      #chatbox {
        flex: 1; /* å¡«æ»¿å‰©é¤˜ç©ºé–“ */
        margin: 0;
        padding: 0;
        border: 1px solid #ccc;
        overflow: auto;
        display: flex;
        flex-direction: column-reverse; /* åè½‰å…§å®¹æ’åˆ— */
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box; /* æ¨è–¦åŠ ä¸Šï¼Œé¿å…å¯¬é«˜è¨ˆç®—èª¤å·® */
      }
          
      p, summary, details {
        /* text-indent: 0; */
      }
      
      #Container {
        border: 2px solid #ffffff;
        /*border-radius: 8px;      åœ“è§’ï¼ˆå¯é¸ï¼‰ */
        background-color: #ffffff; /* ç™½åº•è®“ QR æ›´æ¸…æ¥šï¼ˆå»ºè­°ï¼‰ */
        /*padding: 4px;            é‚Šæ¡†å…§ç•™ç™½ï¼ˆå¯é¸ï¼‰ */
        /*width: 200px;            å›ºå®šå¯¬åº¦ï¼ˆå¯é¸ï¼‰ */
        /*height: auto;*/
      }
      
      
      dialog::backdrop {
          background: rgba(0, 0, 0, 0.6); /* åŠé€æ˜èƒŒæ™¯ */
      }
      dialog {
        /*display: flex; */
        /*flex-direction: column; */
        /*align-items: center;  æ°´å¹³ç½®ä¸­ */
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 1rem;
        border: none;
        border-radius: 8px;
        background-color: black;
        color: white;
        min-width: 90vw;  /* ä¸è¦å¤ªçª„ */
        max-width: 90vw;  /* ä¸è¦å¤ªå¯¬ */
        width: 90vw;
      }
      dialog > * {
        /*display: block; */
        /*margin-left: auto; */
        /*margin-right: auto; */
        /*text-align: center;  æ–‡å­—ç½®ä¸­ */
      }
    </style>
    <style>
      button {
          width: 100%;
          border: none;           /* å»æ‰é‚Šæ¡† */
          border-radius: 0;       /* å»æ‰åœ“è§’ */
          box-shadow: none;       /* å»æ‰é™°å½± */
          background: white;      /* èƒŒæ™¯è‰² */
          color: black;           /* æ–‡å­—é¡è‰² */
          cursor: pointer;        /* ä¿ç•™å¯é»æ“Šæ‰‹å‹ */
          padding: min(1vh,1vw);          /* å¯é¸ï¼šèª¿æ•´å¤§å° */
          transition: none;       /* å»æ‰å‹•ç•«æ•ˆæœ */
      }
    
      button:hover {
        background-color: #cdcdcd;
        color: black;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        background-color: #cdcdcd;
        color: black;
      }
    
      button:active {
        background-color: #ffffff;
        color: gray;
        background-color: #222222;
        color: white;
      }
      
      input:hover {
        background-color: #cdcdcd;
        color: black;
      }
      input:active {
        background-color: #222222;
        color: white;
      }
      input:focus {
        outline: none;              /* ç§»é™¤é è¨­è—è‰²é‚Šæ¡† */
        /* border: 2px solid #4CAF50;  æ”¹ç‚ºç¶ è‰²é‚Šæ¡† */
        /* box-shadow: 0 0 5px #4CAF50; */
        border: 2px solid red;       /* æˆ–ä½¿ç”¨ #f44336 */
        box-shadow: 0 0 5px red;
      }
    </style>
    <!--style>
      .skiptranslate {
        display: none !important;   /* é¿å… display:none å½±éŸ¿å…§å®¹é¡¯ç¤º */
        position: static !important;   /* é˜²æ­¢ä½ç½®ç•°å¸¸ */
        width: 0px !important;
        height: 0px !important;
        margin: 0 !important;
        padding: 0 !important;
        border: none !important;
        background: none !important;
        font-size: inherit !important;
      }
      iframe {
        display: none !important;
      }
    </style-->
    <style>
      iframe.skiptranslate, #goog-gt-tt {
          display: none !important;
      }
      
      /* å‹•ç•«å®šç¾©ï¼šå‘¼å¸ä¸€æ¬¡ */
      @keyframes breatheOnce {
        0%   { color: #cdcdcd; }
        50%  { color: black; }  /*red*/
        100% { color: #cdcdcd; }
      }
  
      .breathe {
        animation: breatheOnce 1s ease-in-out;  /*2s*/
      }

      /* æ–‡å­—é–ƒçˆå‹•ç•« */
      @keyframes textBlink {
          0%, 100% { color: red; }       /* èµ·å§‹èˆ‡çµæŸé¡è‰² */
          50%      { color: black; }     /* é–“éš”é¡è‰² */
      }

      .textBlinkOnce { animation: textBlink 1s steps(1, start); }

      @keyframes blinkBorder {
          0%, 100% { border-color: #FF3B00; }
          50%      { border-color: transparent; }
      }
      
      @keyframes hardBlink {
        0%, 100% { border-color: red; }
        50%      { border-color: transparent; }
      }
      
      .main {
          border: 2px solid red;
          padding: 8px;
          /**animation: blinkBorder 1s infinite;  //===*/
          /* å‘¼å¸å¼å‹•ç•«ï¼šå¹³æ»‘éæ¸¡ */
          /**animation: blinkBorder 1s ease-in-out infinite;  //===*/
          /* é–ƒçˆå¼å‹•ç•«ï¼šç¬é–“åˆ‡æ› */
          animation: hardBlink 1.0s steps(1, start) infinite;
      }
    </style>
  
    <style>
      @keyframes fadeGradient {
        from {
          background: linear-gradient(white, white);
        }
        to {
          background: linear-gradient(white, transparent);
        }
      }
      @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
      }
      .disabled {
        /* pointer-events: none; ä¸èƒ½é» */
        /* opacity: 0.5;         è¦–è¦ºä¸Šç°æ‰ */
      }
    </style>
  
    <style>
        /* è¦†è“‹å±¤æ¨£å¼ */
        #startOverlay {
            position: fixed;
            inset: 0;
            background: white;
            /*z-index: 99999;*/
            display: flex;
            justify-content: center;
            align-items: center;
            color: black;
            font-weight: bold;
            transition: opacity 1s;
            border-radius: 0; /* æ˜ç¢ºè¨­å®šæ–¹è§’ */
            border: none;       /* æ²’æœ‰é‚Šæ¡† */
            outline: none;      /* é¿å…ç€è¦½å™¨è‡ªå¸¶è¼ªå»“ */
            box-shadow: none;   /* é¿å…é™°å½±åƒé‚Šæ¡† */
            flex-direction: column; /* æ”¹ç‚ºå‚ç›´æ’åˆ— */
            cursor: pointer;
            cursor: default;
        }
        /* è®“åœ–ç‰‡æˆç‚ºå½ˆæ€§ä¸»é«” */
        #startOverlay img {
            flex: 1;           /* ä½”æ“šå‰©é¤˜æ‰€æœ‰ç©ºé–“ */
            min-height: 0;     /* é˜²æ­¢åœ–ç‰‡æ’ç ´ flex å®¹å™¨ */
            width: auto;       /* ä¿æŒæ¯”ä¾‹ */
            max-width: 100%;   /* å¯¬åº¦ä¸è¶…éè¢å¹• */
            object-fit: contain; /* ç¢ºä¿åœ–ç‰‡åœ¨ç©ºé–“å…§å®Œæ•´é¡¯ç¤ºï¼Œä¸è¢«è£åˆ‡ */
        }
        .fadeOut { opacity: 0; pointer-events: none; }
    </style>
</head>
<body>
<!-- UPDATE ================================================== -->
<script src="https://copyright.nins.cc/children/0001/nins-update.js"></script>
    <!--div id="google_translate_element" style="display:block;"></div-->
  
    <audio id="NinsXmas" style="display:none;" src="https://copyright.nins.cc/children/2025/xmas.mp3" loop ></audio>
    <button id="startOverlay" disabled
      onclick="this.classList.add('fadeOut');document.getElementById('NinsXmas').play();document.getElementById('NinsXmas').loop = false;"
      style="
      position: fixed;
      bottom: 0;
      top: 0; /* è·é›¢é ‚éƒ¨ 0 */
      left: 0; /* è·é›¢å·¦å´ 0 */
      right: 0; /* è·é›¢å³å´ 0 */
      width: 100%;
      height: 100%;
      border: none;
      padding: 0;
      margin: 0;
      cursor: default;
      display: flex;
      flex-direction: column;
      font-size: 2vw;
      z-index: 99998;">
        <br>
        <span id="say" style="color: #777; font-weight:700;">Give a "Vivre Card/Soul Paper" to everything that matters!â€</span>
        
        
        <img src="https://copyright.nins.cc/children/2025/xmas.png" style=" vertical-align: middle;">
        <span translate="no" id="merryXmas" style="display: none;"></span>
        
        <br>
        <u id="ads" translate="no" style="color: #2222ff; font-weight:700;">https://2025.uris.nins.cc/</u>
        <progress id="progress" value="0" max="3000"></progress>
        <span id="time" translate="no">0 ms</span>
        <br>
    </button>
    
    <button disabled="" id="disabled" style="
      position: fixed;
      bottom: 0;
      top: 0; /* è·é›¢é ‚éƒ¨ 0 */
      left: 0; /* è·é›¢å·¦å´ 0 */
      right: 0; /* è·é›¢å³å´ 0 */
      width: 100%;
      height: 100%;
      border: none;
      padding: 0;
      margin: 0;
      /*opacity: 0;  /*ä¸é€æ˜åº¦*/
      /*background: transparent;  /*ä¸é€æ˜åº¦ï¼Ÿ*/
      cursor: default;
      /*background: linear-gradient(white, transparent);*/
      background: white;
      animation: fadeOut 3s forwards;
      pointer-events: none;  /* å‹•ç•«æœŸé–“ä¸é˜»æ“‹äº’å‹•ï¼ˆå¯é¸ï¼‰*/
      z-index: 99999;  /* ç¢ºä¿åœ¨æœ€é«˜å±¤ */
    "></button>
      

  <div style="
    position: fixed;
    bottom: 0;
    top: 0; /* è·é›¢é ‚éƒ¨ 0 */
    left: 0; /* è·é›¢å·¦å´ 0 */
    right: 0; /* è·é›¢å³å´ 0 */
    width: 100%;
    background: #777777;
    background: #FF3B00;
    background: white;
    color: white;
    text-align: center;
    /*padding: 10px;*/
    box-sizing: border-box;
    word-break: break-word;
    z-index: 10000;
    
    display: flex;
    flex-direction: column;
  ">
        <strong id="anything" style="background-color: black; color: white; font-size: max(1vh,1vw);"><b translate="no">Â© nins. </b>Use chat channels to easily start communicating with anyone.</strong>
        <div style="background: #FFFFFF; color: black;" translate="no">
        <div style="height: 2vh; margin: 10px;" onclick="document.getElementById('DialogCheck').showModal();console.log(new Date().toLocaleString(), 'ğŸ™‰');">
        nins/transing
        </div></div>
        <div style="margin: 0vw; display: flex; flex-direction: row; border: 1px solid #cdcdcd;" translate="no">
            <!--button onclick="document.getElementById('DialogShare').showModal()">ğŸ”—</button-->
            <button onclick="document.getElementById('DialogShare').showModal()">ğŸ”—<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">Connect</p></button>
            <button onclick="document.getElementById('DialogTool').showModal()">ğŸ§°<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">Tool</p></button>
            <button onclick="COPYRIGHT()">ğŸ‘»<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">copyright</p></button>
            <button onclick="DOWNLOAD()">ğŸ’¾<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">Save</p></button>
            <!--button onclick="window.open('https://copyright.nins.cc/children/preview', '_blank', 'noopener,noreferrer');">ğŸ‘€
            <p style="margin: 0; padding: 0; font-size: 1vh;" class="label">Preview</p></button!-->
            <!--button onclick="document.getElementById('DialogPreview').showModal()">ğŸ‘€<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">Preview</p></button!-->
            <button onclick="document.getElementById('DialogPreview').showModal();document.getElementById('DialogPreview').innerHTML = '<iframe src=\'https://copyright.nins.cc/children/preview\' style=\'width:100%; height:100%; border:none; overflow:hidden;\' scrolling=\'no\'></iframe>';">
              ğŸ‘€<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">Preview</p></button>
        </div>
        <input type="range" id="InputSpeed" min="1.0" max="100.0" step="0.1" value="1" style="width:100%; display:none;" />
        
        <!--div style="margin: 0.2vw; display: flex; flex-direction: row; border: 0px solid #cdcdcd;" translate="no">
            <span id="SemanticDistance" style="font-size:1vw; width:100%; text-align:center; color:black;">ï¼ˆSemantic Distanceï¼‰</span>
        </div-->
        
        <div id="chatbox" style="border:1px solid #ccc; overflow:auto; width:100%; text-align:left; flex:1;">init</div>
        
        <input type="range" id="InputRate" min="0.1" max="2.0" step="0.1" value="1" style="width:100%;" />
        <input  style="display:none" class="main" id="InputRoom" type="text" name="noMemory" autocomplete="off" placeholder="input connection number..." style="width:100%; text-align: center;"/>
        <input  style="display:none" class="main" id="InputMsg"  type="text" name="noMemory" autocomplete="off" placeholder="input message text..." style="width:100%; text-align: center;"/>
        <button style="display:none" id="ButtonRoom" onclick="sendSocket()" style="width:100%;" class="button" >ğŸ“¶Send connection</button>
        <button style="display:none" id="ButtonMsg" onclick="sendMessage()" style="width:100%;" class="button" >ğŸš€Send Message</button>
        
        <!--strong></strong-->
        <div style="background: #FF3B00; color: white;" translate="yes">
        <div style="margin: 10px;" onclick="document.getElementById('DialogTrans').showModal();" id="notice">
        By using any of the services, it means you have agreed to any content and all content!
        </div></div>
        <strong style="background-color: black; color: white; font-size: max(1vh,1vw);" translate="no">Â© 2024 NINS (by JPGT).</strong>
        
  </div>

  <dialog id="DialogAds" translate="no" onclick="this.close()" style="background: white; color:black;
      display: flex; flex-direction: column; align-items: center;
      text-align: center; justify-content: center;
      /* pointer-events: none;   å®Œå…¨ä¸èƒ½é» */
      min-width: 90vw; width: 100vw;
      max-height: 90vh; height: 100vh;
  ">
      
      <button id="openLog" style="width: 100%; background: black;" onclick="document.getElementById('DialogTrans').close();console.log(new Date().toLocaleString(), 'ğŸ™ˆ');">â†©ï¸</button>
      <br>
      <iframe data-creative-load-listener="" id="200_287_express_html_inpage_0.if" src="https://s0.2mdn.net/sadbundle/11781765405462098489/index.html?ev=01_262" width="300" height="250" frameborder="0" scrolling="no" allowfullscreen="true" style="width: 300px; height: 250px;"></iframe>
      <progress id="progress_v1" value="0" max="3000"></progress>
      <span id="time_v1">0 ms</span>
      <br>
      <button id="openLog" style="width: 100%; background: black;" onclick="document.getElementById('DialogTrans').close();console.log(new Date().toLocaleString(), 'ğŸ™ˆ');">â†©ï¸</button>
  </dialog>
  
  <dialog id="DialogTrans" translate="no">
      <div id="google_translate_element" style="display:block;"></div>
      <!--br><button id="openLog" style="width: 100%;" onclick="document.getElementById('DialogTrans').close();console.log(new Date().toLocaleString(), 'ğŸ™ˆ');">â†©ï¸</button-->
  </dialog>
  
  <dialog id="DialogPreview" translate="no" style="height: 90vh; overflow: hidden;">
      <iframe src="https://copyright.nins.cc/children/preview" style="width: 100%; height: 100%; border: none;"></iframe>
  </dialog>
    
  <dialog id="DialogCheck" translate="no">
      <pre id="logOutput" style="max-height:200px; overflow:auto; margin:0;"></pre>
      <!--br><button id="openLog" style="width: 100%;" onclick="document.getElementById('DialogCheck').close();console.log(new Date().toLocaleString(), 'ğŸ™ˆ');">â†©ï¸</button-->
  </dialog>
  
  <dialog id="DialogShare" style="background-color: #000000; 
      display: flex; flex-direction: column; align-items: center;
      text-align: center;
  ">
  
      <!--button onclick="document.getElementById('DialogShare').close()" class="text-red-600 mt-3">âŒ</button-->
      <!--br><br-->
      <span style="width:min(80vw, 80vh);">You can set the resolution for the 2D barcode.</span>
      <input style="width:min(80vw, 80vh);" type="range" id="barcodeSlider" min="100" max="500" value="300" disabled=""/><br>
      <a style="width:min(80vw, 80vh); display:none;" id="linkText" rel="noopener noreferrer" href=""></a>
      <img style="width:min(80vw, 80vh); display:none;" id="linkCode" onclick="openLink()" alt='QR Code'>
      <canvas style="width:min(80vw, 80vh); cursor:pointer;" class="" id="qrcode" onclick="openLink()"></canvas><br>
      <!--img src="javascript:void(0)"-->
      
      <!--span style="display:none;">
      <span style="width:100%;">You can set the abilities for the ghost.</span><br>
      <input type="range" id="InputSpeed" min="1.0" max="100.0" step="0.1" value="1" style="width:100%;" /><br>
      <span style="width:100%;">You can set the speed for the audio playback.</span><br>
      <input type="range" id="InputRate" min="0.1" max="2.0" step="0.1" value="1" style="width:100%;" /><br></span-->
  </dialog>
  
  <dialog id="DialogTool" style="background-color: #000000;">
  
      <!--button onclick="document.getElementById('DialogTool').close()" class="text-red-600 mt-3">âŒ</button-->
      <!--br><br-->
      <span style="width:100%;">You can set the display text size.</span>
      <input type="range" id="fontSlider" min="14" max="44" value="14" style="width:100%;" /><br>
      <div style="width:100%;" translate="no">
      
          <!--label id="ButtonTool" translate="no" >ğŸ“ºï¼ˆ<input style="display:none;" type="button" value="ğŸ“º" /></label>
          <span translate="no">
          <span id="width" style="width:100%;" translate="no"></span><span translate="no">x</span>
          <span id="height" style="width:100%;" translate="no"></span>
          ï¼‰</span><br-->
          
          <!--span style="width:100%;" id="copyright">Â© 2024 NINS. ğŸ‘»ï¼ˆğŸ‘»ï¼ŒğŸ‘»ï¼‰ğŸ </span><br-->
          <!--label id="ButtonGT" >ğŸ”„ï¼ˆtranslateï¼‰<input style="display:none;" type="button" value="ğŸ”„" onclick="openTranslate()" /></label><br!-->

          <span id="stateConnection">ğŸ’¬ï¼ˆConnectionï¼‰</span><br>
          <span id="stateTTS">ğŸ‘„ï¼ˆTTSï¼ƒ0ï¼‰</span><br>
          <!--label id="ButtonHear" >ğŸ‘‚<input style="display:none;" type="button" value="ğŸ‘‚" /></label-->
          <!--label id="ButtonMike" >ğŸ™ï¸ï¼ˆmikeï¼‰<input style="display:none;" type="button" value="ğŸ™ï¸" /></label-->

          <a id="LinkAbly" rel="noopener noreferrer" href="https://ably.com/">ğŸ”‘</a><span>ï¼ˆably.comï¼‰</span><br>
          <!--a id="LinkMail" rel="noopener noreferrer" href="mailto:duguaynins@gmail.com">ğŸ’Œ</a><span>ï¼ˆduguaynins@gmail.comï¼‰</span><br-->
          <!--a id="LinkNins" rel="noopener noreferrer" href="https://nins.world">ğŸŒ</a><span>ï¼ˆnins.worldï¼‰</span><br-->
          
          <!--a id="LinkTrans" href="https://translate.google.com/?sl=auto&tl=en&op=translate&text=">ğŸ’¬ğŸ”„ğŸ“±ğŸ“¢</a><span></span-->
          <!--button id="ButtonMike">ğŸ™ï¸</button-->
          <div translate="no">
              <!--label for="Playslang">â–¶ï¸ï¼ˆsl-play: </label>
              <select id="Playslang">
                <option value="1">open</option>
                <option value="0">close</option>
                <option value="auto">auto</option>
              </select>ï¼‰<br-->
              <label for="SwitchSlang">ğŸ”£ï¼ˆsl-switch: </label>
              <input id="SwitchSlang" type="checkbox" onchange="document.getElementById('SelectSlang').disabled = !this.checked;" disabled="">ï¼‰<br>
            
              <label for="SelectSlang">ğŸ”£ï¼ˆsl-in: </label>
              <select id="SelectSlang">
                <!--option value="auto">auto*</option-->
                <option value="en-US">English</option>
                <option value="ja-JP">æ—¥æœ¬èª</option>
                <option value="ko-KR">í•œêµ­ì˜</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
              </select>ï¼‰<br>

              <!--label for="Playtlang">â–¶ï¸ï¼ˆtl-play: </label>
              <select id="Playtlang">
                <option value="1">open</option>
                <option value="0">close</option>
              </select>ï¼‰<br-->
              <label for="SelectTlang">ğŸ¤–ï¼ˆtl-out: </label>
              <select id="SelectTlang">
                <!--option value="auto">auto*</option-->
                <option value="en-US">English</option>
                <option value="ja-JP">æ—¥æœ¬èª</option>
                <option value="ko-KR">í•œêµ­ì˜</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
              </select>ï¼‰<br>

              <!--label for="Playilang">â–¶ï¸ï¼ˆil-play: </label>
              <select id="Playilang" disabled="">
                <option value="1">open</option>
                <option value="0">close</option>
              </select>ï¼‰<br-->
              <label for="Selectilang">ğŸ‘»ï¼ˆil-out: </label>
              <select id="Selectilang">
                <option value="auto">auto*</option>
                <!--option value="auto">auto</option-->
              </select>ï¼‰<br>

              <label for="Playxlang">â–¶ï¸ï¼ˆauto-play: </label>
              <select id="Playxlang">
                <option value="0">close</option>
                <option value="1">intermediate</option>
                <option value="2" selected="selected">target</option>
                <option value="3">source</option>
              </select>ï¼‰<br>

              <label for="AITransing">ğŸ§ ï¼ˆAI-translate: </label>
              <input  id="AITransing" type="checkbox" checked="">ï¼‰<br>

              <label for="SkipForm">ğŸŒï¼ˆskip-form: </label>
              <input  id="SkipForm" type="checkbox" checked="">ï¼‰<br>

              <div style="display: block;">
              <label for="SkipAds">ğŸ“£ï¼ˆskip-ads: </label>
              <input  id="SkipAds" type="checkbox" checked="">ï¼‰***<br></div>
              <!--input  id="SkipAds" type="checkbox" checked="" onclick="document.getElementById('DialogAds').showModal();startSkipAdsProgress();">ï¼‰<br></div!-->
              <!--input  id="SkipAds"type="checkbox" checked="" onclick="document.getElementById('DialogAds').showModal(); setTimeout(() => { document.getElementById('DialogAds').close(); }, 2200);">ï¼‰<br-->
              <!--input  id="SkipAds"type="checkbox" checked="" onclick="if(!this.checked){document.getElementById('DialogAds').showModal();}">ï¼‰<br-->
          </div>
          
          
          
          <label id="ButtonCM" >ğŸ“·ï¼ˆcameraï¼‰<input style="display:none;" type="button" value="ğŸ“·" onclick="DUGUAYNINS()" /></label><br>
          <!--label id="ButtonLK" >ğŸ”—ï¼ˆlinkï¼‰<input style="display:none;" type="button" value="ğŸ”—" onclick="document.getElementById('DialogShare').showModal()"  /></label><br-->
          <!--label for="InputFile">ğŸ“¦ï¼ˆfileï¼‰<input type="button" id="InputFile" value="ğŸ“¦" style="display: none;" onclick="" /></label-->
          <label id="ButtonDL" >ğŸ’¾ï¼ˆsaveï¼‰<input style="display:none;" type="button" value="ğŸ’¾" onclick="DOWNLOAD()" /></label><br>
          <p id="ButtonMike" >ğŸ™ï¸ï¼ˆmikeï¼‰<input style="display:none;" type="button" value="ğŸ™ï¸" /></p>
          
          <span style="width:100%; color:red;" translate="no" id="copyright" >ğŸ‘»ï¼ˆchannels, usersï¼‰</span><br>
      </div>
  </dialog>
  
  
<!-- HTML ================================================== -->

<script>
///document.addEventListener("mouseup", (event) => {  }  ///20260116
document.addEventListener("pointerup", (event) => {
    // #. ç²å–é¸å–çš„æ–‡å­—å…§å®¹
    const selectionObj = window.getSelection();
    if (!selectionObj || selectionObj.rangeCount === 0) return;

    const selectedText = selectionObj.toString().trim();
    if (!selectedText) return;


    if (selectedText) {
        // 1, å–å¾—é¸å–æ–‡å­—çœŸæ­£æ‰€åœ¨çš„ç¯€é»
        const range = selectionObj.getRangeAt(0);
        let node = range.startContainer;
        console.log(node);///if (!node) return;
        
        if (node.nodeType === Node.TEXT_NODE) { node = node.parentElement; }
        console.log(node);///if (!node) return;

        // 2. ç²å–è§¸ç™¼äº‹ä»¶çš„å…ƒç´  ID
        const elementId = node.id || "æ­¤å…ƒç´ æ²’æœ‰ ID";
        const elementId_v1 = event.target.id ? event.target.id : "æ­¤å…ƒç´ æ²’æœ‰ ID";
        const fullSentence = node.innerText;
        const fullSentence_v1 = event.target.innerText;

        // è¼¸å‡ºçµæœ
        console.log("--- é¸å–è³‡è¨Š ---");
        console.log("è¢«é¸å–çš„ ID:", elementId);
        console.log("é¸å–çš„å­—è©:", selectedText);
        console.log("å®Œæ•´å¥å­å…§å®¹:", fullSentence);

        if (elementId.includes("_")) {  
            handleTTS(elementId, [elementId, selectedText, fullSentence]);  ///xlang
        }
    }
});
</script>


<!-- ADS ================================================== -->
<script>

        
        // å»ºç«‹ MutationObserver ç›£è½ InputMsg çš„ style å±¬æ€§
        const observer = new MutationObserver(() => {
            const roomInput = document.getElementById('InputRoom');
            const msgInput = document.getElementById('InputMsg');
            
            if ( !(msgInput.style.display === 'block' || msgInput.style.display === '') ) {
                // InputMsg æ²’é¡¯ç¤º â†’ é¡¯ç¤º InputRoom
                roomInput.style.display = 'block';
                console.log("InputRoom =>>", "block");
            } else {
                // InputMsg æ­£åœ¨é¡¯ç¤º â†’ éš±è— InputRoom
                roomInput.style.display = 'none';
                console.log("InputRoom =>>", "none");
            }
        });
        
        // é–‹å§‹è§€å¯Ÿ
        observer.observe(document.getElementById('InputMsg'), { attributes: true, attributeFilter: ['style'] });


    
        document.getElementById('merryXmas').innerHTML = "â˜ƒï¸ğŸ¦ŒğŸ„âœ¨â­<br>[ Â© nins ] x [ Merry Xmas 2025 ]";
        
        function startSkipAdsProgress() {
            const progress = document.getElementById("progress");
            const timeText = document.getElementById("time");
        
            const totalTime = Number(progress.max); // ç›´æ¥è®€ max
            const interval = 50;
        
            let current = 0;
            progress.value = 0;
            timeText.textContent = "0 ms";
        
            ///setTimeout(update, 16);
            ///setTimeout( () => { document.getElementById("DialogAds").classList.add("disabled") }, 3);
            ///setTimeout( () => { document.getElementById("DialogAds").classList.remove("disabled") }, 3000);
            ///setTimeout( () => { document.getElementById("startOverlay").classList.add("disabled") }, 3);
            ///setTimeout( () => { document.getElementById("startOverlay").classList.remove("disabled") }, 3000);
            setTimeout( () => { document.getElementById("startOverlay").disabled = true; }, 3);
            setTimeout( () => { document.getElementById("startOverlay").disabled = false; }, 3000);
        
            const timer = setInterval(() => {
              current += interval;
              progress.value = current;
              timeText.textContent = current + " ms";
        
              if (current >= totalTime) {
                progress.value = totalTime;
                ///progress.style.setProperty('--progress-color', '#4caf50'); // ç¶ è‰²
                clearInterval(timer);
                timeText.textContent = "done!";
                timeText.textContent = "skip?!";
              }
            }, interval);
        }
        
        ///startSkipAdsProgress();
        setTimeout( () => { startSkipAdsProgress(); }, 1000);
</script>
<!-- ADS ================================================== -->

<script>
const dialog = document.getElementById('DialogCheck');
const logOutput = document.getElementById('logOutput');
/*
const _log = console.log;
console.log = function(...args) {
  _log.apply(console, args);

  const text = args.map(a =>
    typeof a === 'object' ? JSON.stringify(a) : String(a)
  ).join(' ');

  logOutput.insertAdjacentHTML('beforeend', text + '\n');
  logOutput.scrollTop = logOutput.scrollHeight; // âœ… è‡ªå‹•æ»¾åˆ°åº•
}; */

// æ””æˆª console.log èˆ‡ console.error
['log', 'error'].forEach(level => {
  const original = console[level];
  console[level] = function(...args) {
    original.apply(console, args);
    const message = args.map(a => (typeof a === 'object' ? JSON.stringify(a) : a)).join(' ');
    logOutput.insertAdjacentHTML('beforeend', `<div class="${level}">${message}</div>`);
    // æ»¾å‹•åˆ°åº•éƒ¨
    logOutput.scrollTop = logOutput.scrollHeight;
  };
});

// æ¸¬è©¦
const version = (new Date().toLocaleString(), 'v1.20251203.1315 (This is an error test.)');
console.error(version);
console.warn(version);
console.info(version);
console.log(version);
</script>
<!-- LOG ================================================== -->


  <script>
      /*
      async function HuggingFaceAPI(inputs=null) {
        // 20251129
        console.log(inputs);
        const { group, space, path, payload } = inputs;
        const baseUrl = `https://${group}-${space}.hf.space/${path}`;  ///"https://duguaynins-RedirectAPI.hf.space/MultipleEmbeddings/predict";

        const response = await fetch(baseUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await response.json();
        console.log(data);
        return data;
      }  */
      function escapeHtml(str) {
        return str.replace(/&/g, "&amp;")
                  .replace(/</g, "&lt;")
                  .replace(/>/g, "&gt;")
                  .replace(/"/g, "&quot;")
                  .replace(/'/g, "&#039;");
      }
      
      async function HuggingFaceAPI(inputs=null) {
        // 20251205
        try {
          console.log(inputs);
          const { group, space, path, payload } = inputs;
          const baseUrl = `https://${group}-${space}.hf.space/${path}`;  ///"https://duguaynins-RedirectAPI.hf.space/path";

          const response = await fetch(baseUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });

          const data = await response.json();
          console.log(data);
          return data;
        
        } catch (err) {
          console.error(err);
          ///return "error";
          ///return "Server? Wake up!";
          ///return "Server? Cheer up a bit!";
          ///return "Server? Together!";
          ///return {result: {confidences: null, label: '<b translate="no">'+escapeHtml(err.stack)+'</b>' }};  ///err.name+err.message
          return {result: {confidences: null, label: `<a translate="no" href="mailto:duguaynins@gmail.com?subject=${encodeURIComponent( new Date().toISOString() )}&body=${encodeURIComponent( err.stack )}">mailto:duguaynins@gmail.com</a>` }};  ///escapeHtml(err.stack)
        }
      }

      async function channels(params) { 
        console.log('é »é“ç¢ºèª:', params);
        const { email } = params;
        ///const { smsg, rmsg } = params;
        ///if (smsg === rmsg) { return "{goog:1.0||meta:1.0}"; }

        const inputs = { "inputs": { "a": email } };
        const outputs = await HuggingFaceAPI({
          group: "duguaynins",
          space: "RedirectAPI",
          path: `channels/ably?email=${email}`,  ///embeddings/meta
          payload: inputs,
        }); 

        console.log("INPUT:", inputs);
        console.log("OUTPUT:", outputs);
        return outputs.result;///.label
      }

      async function semantic(params) { 
        console.log('ç¿»è­¯æ¯”å°:', params);
        const { smsg, rmsg } = params;
        if (smsg === rmsg) { return "{goog:1.0||meta:1.0}"; }

        const inputs = { "inputs": { "a": smsg, "b": rmsg } };
        const outputs = await HuggingFaceAPI({
          group: "duguaynins",
          space: "RedirectAPI",
          path: "MultipleEmbeddings/predict",  ///embeddings/meta
          payload: inputs,
        }); 

        console.log("INPUT:", inputs);
        console.log("OUTPUT:", outputs);
        return outputs.result.label;
      }

      async function translate(params) {  
        console.log('ç¿»è­¯æ–‡æœ¬:', params);
        const { text, source = 'auto', target } = params;
        if (source === target) { return text; }
        if (!text) { console.error("text?");return; }

        const inputs = { "inputs": {"text":text,"target":target,"source":source} };
        const outputs = await HuggingFaceAPI({
          group: "duguaynins",
          space: "RedirectAPI",
          path: "MultipleTransings/predict",  ///transings/deep
          payload: inputs,
        }); 

        console.log("INPUT:", inputs);
        console.log("OUTPUT:", outputs);
        return outputs.result.label;
      }
      
      async function generate(params) {  
        console.log('ç¿»è­¯æ–‡æœ¬:', params);
        const { text, source = 'auto', target } = params;
        if (source === target) { return text; }
        if (!text) { console.error("text?");return; }

        ///const inputs = { "inputs": {"text":text,"target":target,"source":source} };
        ///const langs = { [tlang]: "Hello", [ilang]: "ã“ã‚“ã«ã¡ã¯", ko: "ì•ˆë…•í•˜ì„¸ìš”"};
        ///const langs = {}; target.forEach(pair => { langs[pair.code] = pair.text; });
        const langs = { [target.il]: "_", [target.tl]: "_"};  ///{en:_, ja:_, ko:_}

        ///const system = "You are a translation and generation expert. You will directly translate any input language into JSON output: {en:_, ja:_, ko:_}";
        const system = `You are a translation and generation expert. You will directly translate any input language into JSON output: ${JSON.stringify(langs)}`;
        const user = text;
        const inputs = { "inputs": {models:'gpt-4o-mini',system:system ,user:user} }
        const outputs = await HuggingFaceAPI({
          group: "duguaynins",
          space: "RedirectAPI",  ///MultipleLLMs
          path: "generate/llms",  ////run/predict, api/predict, predict, /queue/join
          payload: inputs,
        }); 

        console.log("INPUT:", inputs);
        console.log("OUTPUT:", outputs);
        ///return outputs.result.label;
        return outputs;
      }
  </script>

    
  <script>
  //////document.getElementById("InputRoom").focus();
  document.querySelectorAll("dialog").forEach(dialog => {
      dialog.addEventListener("click", function (event) {
        const rect = this.getBoundingClientRect();
        const isInDialog =
          event.clientX >= rect.left &&
          event.clientX <= rect.right &&
          event.clientY >= rect.top &&
          event.clientY <= rect.bottom;
    
        if (!isInDialog) {
          this.close();
        }
      });
  });
  </script>
  <script>
  /*
  function openLink(event, el) {
    event.preventDefault(); // é˜»æ­¢åŸæœ¬çš„è·³è½‰  // å°‡å…ˆåŸ·è¡Œ onclickï¼Œå†ä¾æ“š href è·³è½‰
    const href = el.getAttribute("href");
    window.open(href, "_blank", "noopener,noreferrer");
  }
  */
  function openLink(event, el) {
    ///event.preventDefault(); // é˜»æ­¢åŸæœ¬çš„è·³è½‰  // å°‡å…ˆåŸ·è¡Œ onclickï¼Œå†ä¾æ“š href è·³è½‰
    const href = document.getElementById("linkText").getAttribute("href");
    window.open(href, "_blank", "noopener,noreferrer");
  }

  function openTranslate(event, el) {
    ///event.preventDefault(); // é˜»æ­¢åŸæœ¬çš„è·³è½‰  // å°‡å…ˆåŸ·è¡Œ onclickï¼Œå†ä¾æ“š href è·³è½‰
    const value = document.getElementById("InputMsg").value;
    const url = "https://translate.google.com/?hl=&sl=auto&tl=zh-TW&op=translate&text=" + encodeURIComponent(value);
    window.open(url, "_blank", "noopener,noreferrer");
  }
  </script>
  <script>
    ///document.getElementById('chatbox').style.backgroundColor = '#777777';  ///background-color: #777777;
    function languageScript(tag) {
      return tag.split('-').slice(0, 2).join('-');
    }
    function languageRegion(tag) {
      const match = tag.match(/^([^-]+)-([^-]+)$/); // å˜—è©¦åŒ¹é…å…©æ®µ
      if (match) return match[1] + '-' + match[2];
      
      // å¦‚æœæœ‰ä¸‰æ®µä»¥ä¸Šï¼Œå–ç¬¬ä¸€æ®µ + æœ€å¾Œä¸€æ®µ
      const parts = tag.split('-');
      if (parts.length >= 2) return parts[0] + '-' + parts[parts.length - 1];

      return tag; // åªæœ‰èªè¨€
    }
    
    // ç”Ÿæˆéš¨æ©Ÿå­—å…ƒå€‹æ•¸*****
    function randomAlphaString(length) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
      let result = "";
      for (let i = 0; i < length; i++) {
        result += chars[Math.floor(Math.random() * chars.length)];
      }
      return result;
    }
    
    
    // åˆå§‹åŒ–å…¨åŸŸè®Šæ•¸*****
    // èŠå¤©****
    // é€£ç·š****
    // ç¿»è­¯****
    const params = new URLSearchParams(window.location.search);
    
    const uuid_user = randomAlphaString(32);  // ç”Ÿæˆ32å­—å…ƒ
    ///const uuid_user = randomAlphaString(64);  // ç”Ÿæˆ64å­—å…ƒ
    let ably; // é€£ç·šä»‹é¢
    let channel = null;  // æ ¹æ“šæˆ¿é–“é€£ç·š
    
    // ğŸ”‘  ///prompt("ï¼ˆğŸ”‘: ***ï¼‰")
    let apikey_user = "";
    
    const ilang = "en-US";  // tlang === ä¸­é–“èªè¨€
    
    ///const tlang = navigator.language || navigator.userLanguage || "en-US";  // é–±è®€æ¯èª
    ///const tlang = languageScript(navigator.language || navigator.userLanguage || "en-US");  // é–±è®€æ¯èª
    let xlang = languageRegion(navigator.language || navigator.userLanguage || "en-US");  // é–±è®€æ¯èª
    
    let tlang = params.get("tl") || xlang;  // tlang === å­¸ç¿’èªè¨€
    let slang = params.get("sl") || xlang;  // slang === å¸¸ç”¨èªè¨€
    ///let tlang = params.get("tl") === "auto" ? xlang : params.get("tl")
    ///let slang = params.get("sl") === "auto" ? xlang : params.get("sl")
    let smike = params.get("mk") || xlang;
    
    let speed = 1.2;
  </script>
  
  
  
  
  
  <script>
    // ç›£è½è¼¸å…¥
    ///window.addEventListener("keydown", updateWindowSize);  // æŒ‰éˆ•æŒçºŒç›£è½
  
    /*
    // ç›£è½é»æ“Š
    document.getElementById("ButtonHear").addEventListener("click", () => {
      const button = document.getElementById("ButtonHear");
      if (button.textContent === "ğŸ‘‚") { button.textContent = "ğŸ‘‚åˆªæ¸›ä¸­"; }
      if (button.textContent === "ğŸ‘‚è¿½åŠ ä¸­") {
        button.textContent = "ğŸ‘‚åˆªæ¸›ä¸­";
        document.querySelectorAll(".msgtLangm").forEach(el => { el.style.display =  'none'; });
      } else {
        button.textContent = "ğŸ‘‚è¿½åŠ ä¸­";
        document.querySelectorAll(".msgtLangm").forEach(el => { el.style.display =  ''; });
      }
    });
    */
    
    // è¼¸å…¥æ¡†è¢«ç„¦é»æ™‚
    document.getElementById("InputRoom").addEventListener('focus', function() {
        // é¸å–æ‰€æœ‰ <details> å…ƒç´ 
        const allDetails = document.querySelectorAll('details');
        // è¿­ä»£æ¯å€‹ <details> å…ƒç´ ï¼Œä¸¦ç§»é™¤å…¶ 'open' å±¬æ€§
        allDetails.forEach(detail => { detail.removeAttribute('open'); });
        ///document.getElementById('InputRoom').focus();
        console.log("InputRoom focus:", 0);
    });
    document.getElementById("InputMsg").addEventListener('focus', function() {
        // é¸å–æ‰€æœ‰ <details> å…ƒç´ 
        const allDetails = document.querySelectorAll('details');
        // è¿­ä»£æ¯å€‹ <details> å…ƒç´ ï¼Œä¸¦ç§»é™¤å…¶ 'open' å±¬æ€§
        allDetails.forEach(detail => { detail.removeAttribute('open'); });
        ///document.getElementById('InputMsg').focus();
        console.log("InputMsg focus:", 0);
    });
    
    // è¼¸å…¥æ¡†è¢«è¼¸å…¥æ™‚
    document.getElementById("InputRoom").addEventListener("keydown", function(e) {
        // é¸å–æ‰€æœ‰ <details> å…ƒç´ 
        const allDetails = document.querySelectorAll('details');
        // è¿­ä»£æ¯å€‹ <details> å…ƒç´ ï¼Œä¸¦ç§»é™¤å…¶ 'open' å±¬æ€§
        allDetails.forEach(detail => { detail.removeAttribute('open'); });
        document.getElementById('InputRoom').focus();
        
        if (e.key === "Enter") {
          e.preventDefault();  // é˜»æ­¢ Enter éµçš„é è¨­è¡Œç‚ºï¼ˆå³é˜²æ­¢è·³è½‰åˆ°ä¸‹ä¸€å€‹è¼¸å…¥æ¡†ï¼‰
          ///alert("Enterï¼š" + this.value);
          ///document.getElementById("ButtonRoom").click();
          sendSocket();
        }
        console.log("InputRoom keydown:", 0);
    });
    document.getElementById("InputMsg").addEventListener("keydown", function(e) {
        // é¸å–æ‰€æœ‰ <details> å…ƒç´ 
        const allDetails = document.querySelectorAll('details');
        // è¿­ä»£æ¯å€‹ <details> å…ƒç´ ï¼Œä¸¦ç§»é™¤å…¶ 'open' å±¬æ€§
        allDetails.forEach(detail => { detail.removeAttribute('open'); });
        document.getElementById('InputMsg').focus();
      
        if (e.key === "Enter") {
          e.preventDefault();  // é˜»æ­¢ Enter éµçš„é è¨­è¡Œç‚ºï¼ˆå³é˜²æ­¢è·³è½‰åˆ°ä¸‹ä¸€å€‹è¼¸å…¥æ¡†ï¼‰
          ///alert("Enterï¼š" + this.value);
          ///document.getElementById("ButtonMsg").click();
          sendMessage();
        }
        console.log("InputMsg keydown:", 0);
    });
  </script>

  <script src="https://unpkg.com/bwip-js/dist/bwip-js-min.js"></script>
  <script>
    function updateWindowSize() {
        const size = document.getElementById("fontSlider").value;
        document.getElementById("chatbox").style.fontSize = `${size}px`;
    }
    ///window.addEventListener('resize', () => {});
    window.addEventListener("resize", updateWindowSize);  // è¦–çª—æŒçºŒç›£è½
    ///window.addEventListener("keydown", updateWindowSize);  // æŒ‰éˆ•æŒçºŒç›£è½
    ///window.addEventListener("scroll", updateWindowSize);  // æ»¾å‹•æŒçºŒç›£è½

    ///document.addEventListener('DOMContentLoaded', () => {document.getElementById("fontSlider").value = window.innerWidth / 66;});  // è¼‰å…¥ç›£è½
    document.addEventListener('DOMContentLoaded', updateWindowSize);  // è¼‰å…¥ç›£è½
    // AND
    // å­—é«”***æ ¹æ“šæ‹‰æ¢å¤§å°è‡ªå‹•****
    document.getElementById("fontSlider").addEventListener('input', updateWindowSize);
    
    
    
    function gencode(text, bcid, format) {
        if ( format.test(text) && text.trim()!=="" ) {
            bwipjs.toCanvas( bcid, {
                bcid:        bcid,     // æ¢ç¢¼æ ¼å¼
                text:        text,     // æ¢ç¢¼å…§å®¹  // "Hello world!"
                scale:       4,
                ///alttext:     bcid,     // âœ… æ›¿ä»£é¡¯ç¤ºçš„æ–‡å­—
                barcolor:    '000000',  // æ¢ç¢¼é¡è‰²ï¼ˆç´…è‰²ï¼‰
                textcolor:   '000000',  // æ–‡å­—é¡è‰²ï¼ˆè—è‰²ï¼‰
                backgroundcolor: 'FFFFFF',  // å¢åŠ é€™è¡Œä¾†è¨­å®šç™½è‰²åº•è‰²
                padding: 2, // å¢åŠ  10 åƒç´ çš„èƒŒæ™¯å¡«å……
                ///includetext: true,  // é€™è¡Œæœƒå°è‡´éŒ¯èª¤
            });
            document.getElementById(bcid).style.margin = "1em 0";
            document.getElementById(bcid).style.display = "block";
        }
        else {
            document.getElementById(bcid).style.display = "none";
        }
    }
    function updateQR(token="") {  ///() => {   ///function () {
        console.log('æ›´æ–°æ¢ç¢¼:', token);
        // æ ¼å¼åŒ–å¥—ç”¨**
        const size = document.getElementById('barcodeSlider').value;
        const input = document.getElementById('InputRoom').value.split('&&')[0];  // OR this.value;
        console.log('æ›´æ–°æ¢ç¢¼å¤§å°:', size);
        console.log('æ›´æ–°æ¢ç¢¼å…§å®¹:', input);
        
        
        let baseUrl = null;
        baseUrl = window.location.origin + window.location.pathname + "?channel=" + encodeURIComponent(input); /// + "&idle=" + params.get("idle");
        const secret = "nins";
        if (token && token!=="nins") {baseUrl += "&token="+token + "&idle="+secret}
        

        gencode(text=baseUrl, bcid="qrcode", format=/^.{0,1000}$/)

        ///const qrUrl = "https://api.qrserver.com/v1/create-qr-code/?size="+size+"x"+size+"&data=" + encodeURIComponent(baseUrl);
        ///const qrUrl = "https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=" + baseUrl;  // æœªç·¨ç¢¼ï¼Œæ£„ç”¨æ­¤ã€‚
        ///document.getElementById("linkCode").src = qrUrl;
      
        document.getElementById("linkText").href = baseUrl;  //???
    }
    
    // ä¸æœƒå†æœ‰ [object Event] è¢«ç•¶ä½œåƒæ•¸å‚³å…¥çš„éŒ¯èª¤ã€‚  ///!!!
    // æ¢ç¢¼***æ ¹æ“šæ‹‰æ¢è®ŠåŒ–ç”Ÿæˆ+å¤§å°****
    ///document.getElementById('barcodeSlider').addEventListener('input', updateQR);
    document.getElementById('barcodeSlider').addEventListener('input', () => { updateQR(); });
    // AND
    // æ¢ç¢¼***æ ¹æ“šå…§å®¹è®ŠåŒ–ç”Ÿæˆ****
    ///document.getElementById('InputRoom').addEventListener('input', updateQR);
    document.getElementById('InputRoom').addEventListener('input', () => { updateQR(); });
    // AND
    // æ¢ç¢¼***åˆå§‹åŒ–****
    ///document.addEventListener('DOMContentLoaded', updateQR);
    document.addEventListener('DOMContentLoaded', () => { updateQR(); });
  </script>
  
  
  
  <script>
  
    let voices = null;
    // ç¬¬ä¸€æ¬¡åˆå§‹åŒ–èªéŸ³****
    document.addEventListener('DOMContentLoaded', function () {
        voices = window.speechSynthesis.getVoices();
        ///voices = speechSynthesis.getVoices();
        console.log("Voices loaded:", voices.length);
        console.log("Voices loaded:", voices);
        
        if (voices.length > 0) {
            ///alert("GET TTS VOICEï¼ƒ: " + voices.length);
            document.getElementById("stateTTS").textContent = "ğŸ‘„ï¼ˆTTSï¼ƒ" + voices.length + "ï¼‰";
        } else {
            ///document.getElementById("stateTTS").textContent = "ğŸ‘„ï¼ˆTTSï¼ƒ" + 0 + "ï¼‰";
        }
    });
    
    
    // ç›£è½çš„åˆå§‹åŒ–èªéŸ³****
    ///window.speechSynthesis.onvoiceschanged = () => {
    window.speechSynthesis.addEventListener('voiceschanged', () => {
        voices = window.speechSynthesis.getVoices();
        ///voices = speechSynthesis.getVoices();
        console.log("Voices loaded:", voices.length);
        console.log("Voices loaded:", voices);
        
        /*
        voices.forEach((voice, index) => {
          console.log(
            `${index + 1}. åç¨±: ${voice.name}, èªè¨€: ${voice.lang}, æ˜¯å¦é è¨­: ${voice.default}`
          );
        });  */
      
        if (voices.length > 0) {
            ///alert("GET TTS VOICEï¼: " + voices.length);
            document.getElementById("stateTTS").textContent = "ğŸ‘„ï¼ˆTTSï¼" + voices.length + "ï¼‰";
        } else {
            ///document.getElementById("stateTTS").textContent = "ğŸ‘„ï¼ˆTTSï¼ƒ" + 0 + "ï¼‰";
        }
        
    });
  </script>
  
  <script>
    
    
    
    
    ///20250609 1947
    
    
    // ç›£è½è¦–çª—å¤§å°***
    function updateStructSize() {
        ///console.log("è¦–çª—é«˜åº¦ï¼š" + window.innerHeight + " px");
        ///console.log("è¦–çª—å¯¬åº¦ï¼š" + window.innerWidth + " px");
        //////document.getElementById('chatbox').style.height = (window.innerHeight * 0.7) + 'px'; // ä½” 70%
        ///document.getElementById('InputRoom').style.height = (window.innerHeight * 0.05) + 'px'; // ä½” 10%
        ///document.getElementById('InputMsg').style.height = (window.innerHeight * 0.05) + 'px'; // ä½” 10%
        
        ///document.getElementById('copyright').style.height = (window.innerHeight * 0.05) + 'px'; // ä½” 10%
        ///document.getElementById('detail').style.height = (window.innerHeight * 0.10) + 'px'; // ä½” 10%
        
        const buttons = document.querySelectorAll('button');

        buttons.forEach(btn => {
          //btn.style.margin = '0';
          //btn.style.padding = '0';
          ///btn.style.border = 'none';
        });
        
        ///document.getElementById('ButtonRoom').style.width = (window.innerWidth * 1.0) + 'px'; // ä½” 10%
        ///document.getElementById('ButtonMsg').style.width = (window.innerWidth * 1.0) + 'px'; // ä½” 10%
        ///document.getElementById("Container").style.padding = (window.innerWidth / 66) + "px";  //QR
        ///document.getElementById("NINS").style.padding = (window.innerWidth / 66) + "px";  //QR
        ///document.getElementById("NINS").style.width = (window.innerHeight / 2) + "px";  //QR
    }
    ///window.addEventListener('resize', () => {});
    window.addEventListener("resize", updateStructSize);  // è¦–çª—æŒçºŒç›£è½
    window.addEventListener("keydown", updateStructSize);  // æŒ‰éˆ•æŒçºŒç›£è½
    window.addEventListener("scroll", updateStructSize);  // æ»¾å‹•æŒçºŒç›£è½
    ///window.onload = function() {};
    window.onload = updateStructSize;
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
        console.log("åŒæ­¥åˆå§‹åŒ–ï¼Œè¦–çª—é«˜åº¦ï¼š" + window.innerHeight + " px");
        console.log("åŒæ­¥åˆå§‹åŒ–ï¼Œè¦–çª—å¯¬åº¦ï¼š" + window.innerWidth + " px");
        document.getElementById('chatbox').textContent = "After using the 'Send Connection' button and successfully establishing the connection, you can use 'Send Message' to communicate.";    
        document.getElementById('chatbox').textContent = "Currently, only the *WORLD* channel is available. The limit will be removed soon.";
      });
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', async function () {
        console.log("éåŒæ­¥åˆå§‹åŒ–ï¼Œè¦–çª—é«˜åº¦ï¼š" + window.innerHeight + " px");
        console.log("éåŒæ­¥åˆå§‹åŒ–ï¼Œè¦–çª—å¯¬åº¦ï¼š" + window.innerWidth + " px");
        document.getElementById('chatbox').textContent = "After using the 'Send Connection' button and successfully establishing the connection, you can use 'Send Message' to communicate.";    
        document.getElementById('chatbox').textContent = "Currently, only the *WORLD* channel is available. The limit will be removed soon.";
      });
    
    // åˆå§‹åŒ–ï¼šé»˜èªæƒæé€£ç·š
    
    ///20250616 1415
    document.addEventListener('DOMContentLoaded', async function () {
      const language = slang || (navigator.language || navigator.userLanguage || "en-US");
      const source = "en";
      const target = language;
      let message = ""
      document.getElementById('InputRoom').placeholder = "(ğŸ‘ï¸" + language + ", ğŸ“¶Use the same channel to connect." + ")";  // as other devices to connect
      document.getElementById('InputMsg').placeholder = "(ğŸ‘ï¸" + language + ", ğŸš€Use your native language to chat." + ")";  //ğŸ‘ï¸ğŸ‘€ğŸ‘„
      
    });
    
    </script>
    
  <script>
    // é€£ç·šå‰çš„ç¦ç”¨****
    document.getElementById('SelectSlang').disabled = true;  // ç¦ç”¨
    ///document.getElementById('SelectSlang').style.display = 'none';
    document.getElementById('SelectTlang').disabled = true;  // ç¦ç”¨
    ///document.getElementById('SelectTlang').style.display = 'none';
    document.getElementById('Selectilang').disabled = true;  // ç¦ç”¨
    ///document.getElementById('Selectilang').style.display = 'none';
    
    document.getElementById('InputMsg').disabled = true;  // ç¦ç”¨
    document.getElementById('InputMsg').style.display = 'none';
    document.getElementById('ButtonMsg').disabled = true;  // ç¦ç”¨
    document.getElementById('ButtonMsg').style.display = 'none';
    document.getElementById('ButtonMike').disabled = true;  // ç¦ç”¨
    document.getElementById('ButtonMike').style.display = 'none';
    ///document.getElementById('BurronLink').disabled = true;  // ç¦ç”¨
    ///document.getElementById('BurronLink').style.display = 'none';
    document.getElementById('chatbox').disabled = true;  // ç¦ç”¨
    document.getElementById('chatbox').style.backgroundColor = '#cdcdcd';  ///#777777
    
    ///document.getElementById('ButtonRoom').disabled = true;  // ç¦ç”¨
    document.getElementById('ButtonRoom').style.display = 'none';  // ä¸ç¦ç”¨ï¼Œä½†éš±è—
    const EmojisUser = [
      "ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼", "ğŸ¨", "ğŸ¯",
      "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ¸", "ğŸµ", "ğŸ”", "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ£",
      "ğŸ¥", "ğŸ¦†", "ğŸ¦‰", "ğŸ¦‡", "ğŸº", "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ", "ğŸ›",
      "ğŸŒ", "ğŸ¦‹", "ğŸ", "ğŸ•·", "ğŸ¦‚", "ğŸ¢", "ğŸ", "ğŸ¦–", "ğŸ™", "ğŸ ",
      "ğŸŸ", "ğŸ¦ˆ", "ğŸ¬", "ğŸ³", "ğŸ‹", "ğŸŒ", "ğŸ¦", "ğŸ", "ğŸ", "ğŸŠ",  //5
      "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡", "ğŸ“", "ğŸ’", "ğŸ", "ğŸ¥¥", "ğŸ¥", "ğŸ…",
      "ğŸ¥‘", "ğŸ†", "ğŸ¥¦", "ğŸ¥¬", "ğŸ¥’", "ğŸŒ¶", "ğŸ¥•", "ğŸ¥”", "ğŸ ", "ğŸŒ½",
      "ğŸ¥", "ğŸ", "ğŸ¥–", "ğŸ¥¨", "ğŸ¥¯", "ğŸ§€", "ğŸ³", "ğŸ¥š", "ğŸ”", "ğŸŸ",
      "ğŸ•", "ğŸŒ­", "ğŸ¿", "ğŸ¥—", "ğŸ", "ğŸ¥¨", "ğŸœ", "ğŸ£", "ğŸ±", "ğŸ›",
      "ğŸ™", "ğŸš", "ğŸ˜", "ğŸ¥", "ğŸ¡", "ğŸ¢", "ğŸ¿", "ğŸ®", "ğŸ­", "ğŸ©",  //10
      "ğŸª", "ğŸ‚", "ğŸ°", "ğŸ¦", "ğŸ§", "ğŸ¨", "ğŸ§", "ğŸ«", "ğŸ¬", "ğŸ­",
      "â˜•", "ğŸµ", "ğŸ¶", "ğŸ·", "ğŸ¸", "ğŸ¹", "ğŸ§ƒ", "ğŸ¥¤", "ğŸ§Š"
    ];
    const EmojisClock = [
      "ğŸ•›", // 00
      "ğŸ•", // 01
      "ğŸ•‘", // 02
      "ğŸ•’", // 03
      "ğŸ•“", // 04
      "ğŸ•”", // 05
      "ğŸ••", // 06
      "ğŸ•–", // 07
      "ğŸ•—", // 08
      "ğŸ•˜", // 09
      "ğŸ•™", // 10
      "ğŸ•š", // 11
      "ğŸ•›", // 12
      "ğŸ•", // 13
      "ğŸ•‘", // 14
      "ğŸ•’", // 15
      "ğŸ•“", // 16
      "ğŸ•”", // 17
      "ğŸ••", // 18
      "ğŸ•–", // 19
      "ğŸ•—", // 20
      "ğŸ•˜", // 21
      "ğŸ•™", // 22
      "ğŸ•š"  // 23
    ];
    
    if (params.get("channel") !== null) { document.getElementById("InputRoom").value = params.get("channel"); }
    if (params.get("message") !== null) { document.getElementById("InputMsg").value = params.get("message"); }
    ///document.getElementById("InputRoom").value = params.get("channel") || "";  // å–å¾— ?room= å¾Œé¢çš„å€¼  //BETA***
    ///document.getElementById("InputMsg").value = params.get("message") || "";  // å–å¾— ?room= å¾Œé¢çš„å€¼  //Hello.
    ///document.getElementById("ButtonRoom").focus();
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    
    
    // æª¢æŸ¥ä½¿ç”¨çš„è£ç½®ï¼Œæ˜¯è¡Œå‹•è£ç½®æ™‚ï¼Œå›å‚³ TRUE
    function isMobileDevice() {  ///TEST
      return /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
    }
    
    
    // é€£ç·šé–’ç½®æª¢æŸ¥****
    let lastSentTime = Date.now();
    function userIdleChecker(idleMinutes = params.get("idle") || 2) {    // æ¯å¹¾åˆ†é˜æª¢æŸ¥æ˜¯å¦é–’ç½®
    ///function userIdleChecker(idleMinutes = 2) {    // æ¯å¹¾åˆ†é˜æª¢æŸ¥æ˜¯å¦é–’ç½®
        if (idleMinutes == "nins") console.log('NINS!!!MAX!!!');
        if (idleMinutes == "nins") return;
        
        lastSentTime = lastSentTime;
        idleMinutes = parseFloat(idleMinutes);
        console.log('idleSet: ', idleMinutes);
        ///if (idleMinutes == "NaN") idleMinutes = 0.5;
        if (isNaN(idleMinutes)) idleMinutes = 2.0;         // âœ… æ­£ç¢ºåˆ¤æ–· NaN
        if (idleMinutes < 0.1) idleMinutes = 2.0;
        if (idleMinutes > 5.0) idleMinutes = 2.0;
        ///idleMinutes = 60;  // é–’ç½®ç‹€æ…‹ä»¥å·²å°æ™‚ç‚ºé™ï¼Ÿï¼Ÿï¼Ÿ
        console.log('idleSet: ', idleMinutes);
        
        setInterval(() => {
          const now = Date.now();
          const idleTime = now - lastSentTime;
    
          if (ably) { // é€£ç·šå­˜åœ¨
            ///console.log('nowTime: ', now);
            ///console.log('lastTime: ', lastSentTime);
            
            if (idleTime > idleMinutes * 60 * 1000) {  // ç‰¹å®šæ™‚é–“å…§æœªç™¼è¨Šæ¯
            
                if (!apikey_user && ably.connection.state!="closed") {
                  console.log('âš ï¸ é–’ç½®è¶…æ™‚ã€‚');
                  
                  // å–å¾—æ™‚é–“**
                  const nowUTC = new Date().toISOString();
                  const hourUTC = new Date(nowUTC).getUTCHours();  // å–å¾— UTC å°æ™‚ï¼ˆ0-23ï¼‰
                  const emoji_clock = EmojisClock[hourUTC];
                  const [times, offset] = updateTime();
                  const ninsTimes = times;/// + offset;
                  
                  // é›¢ç·šé¡¯ç¤º**
                  ably.close(); // Close existing connection if it exists
                  const p = document.createElement('p');
                  p.innerHTML = `${emoji_clock}${ninsTimes}<br>ï¼ˆâ›”${uuid_user || 'USER'}ï¼‰`;p.style.color = 'red';  ///ğŸ”´
                  p.setAttribute('translate', 'no');  //???
                  ///document.getElementById("chatbox").prepend(p);
                  ///document.getElementById("chatbox").insertBefore(p, document.getElementById("anchor"));
                  document.getElementById('anchor').after(p);
          
                  
                  // é˜»éš”ä½¿ç”¨**
                  ///document.getElementById("disabled").disabled = true;
                  ///document.getElementById("disabled").style.display = '';
                  
                  document.getElementById("InputMsg").disabled = true;
                  document.getElementById("ButtonMsg").disabled = true;
                  document.getElementById("InputMsg").style.display = 'none';
                  document.getElementById("ButtonMsg").style.display = 'none';
                  document.getElementById("chatbox").style.backgroundColor = '#cdcdcd';
                  ///document.getElementById("InputMsg").style.backgroundColor = '#cdcdcd';
                } 
                
            } ///else { console.log('idle...?'); }
          } ///else { console.log('connect...?'); }
          
        }, 60000/60); // æª¢æŸ¥æ–¼æ¯åˆ†é˜ä¹‹å¹¾
    };userIdleChecker();
    
    
    // æ¥æ”¶****
    // ç«‹å³è¨»å†Šè¨‚é–±ç›£è½
    async function sendMessage() {
        lastSentTime = Date.now();
        
        ///let message = null;
        ///let source = null;
        ///let target = null;
        
        // ç¢ºä¿å…§å®¹***
        const input = document.getElementById('InputMsg');
        const msg = input.value;
        if (!msg) { document.getElementById('InputMsg').focus();return; }  // åˆ¤æ–·å…§å®¹å­˜åœ¨èˆ‡å¦
        
        // æ­£è¦åŒ–å»é™¤ä½¿ç”¨è€…è¼¸å…¥çš„è¡¨æƒ…***
        const emojiRegex = /([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|\uD83E[\uDD00-\uDDFF])/g;
        // æ¯”å°æ³•
        ///const hasEmoji = emojiRegex.test(msg);
        ///const emojis = msg.match(emojiRegex);
        // æ¸…é™¤æ³•
        ///message = "I sent a test message.";
        ///message = "...";
        ///source = 'en';
        ///target = xlang;
        let xmsg = msg.replace( emojiRegex, '' )
        if (!xmsg) return;  //???
        ///await translate(message, source, target);  // é€²è¡Œç¿»è­¯**
        
        // æ¸¬è©¦å…ˆè¡Œåˆªé™¤***
        input.value = '';
        
        
        
        
        
        // æ¸¬è©¦IFRAME***
        
          // 1. å®šç¾© IFRAME å…§éƒ¨è¦é¡¯ç¤ºçš„å®Œæ•´ HTML å…§å®¹
          
          // 2. ç²å–è¦æ’å…¥ IFRAME çš„å®¹å™¨
      
          // 3. å‰µå»ºä¸€å€‹ IFRAME å…ƒç´ 
      
          // 4. å°‡å®šç¾©å¥½çš„ HTML å…§å®¹è³¦å€¼çµ¦ IFRAME çš„ srcdoc å±¬æ€§ 
          
          // 5. æ¸…ç©º <details> é™¤äº† <summary> çš„å…§å®¹ 
          
          // 6. æ’å…¥ iframeï¼ˆåœ¨ summary å¾Œï¼‰
          
        // æ¸¬è©¦IFRAME***
        
        
        // èŠå¤©çš„æ™‚é–“è¨˜éŒ„***
        
        ///window.open("https://translate.google.com/?sl=auto&tl=en&op=translate&text=" + smsg, "_blank");alert();
        ///document.getElementById('LinkTrans').href = "https://translate.google.com/?sl=auto&tl=en&op=translate&text=" + smsg;
        ///const imsg = prompt("ï¼ˆen: ***ï¼‰");

        
        let smsg = "";let tmsg = "";let imsg = "";
        if (!!document.getElementById("AITransing").checked) {  ///SkipForm, SwitchSlang
          // è¿½åŠ çš„æ›´æ–°æ¸¬è©¦***
          const gens = await generate({ "text": xmsg, "source": null, "target": {tl:tlang, il:ilang} });  // æ¸¬è©¦å–ä»£é¦–æ¬¡ç¿»è­¯  //ALARM???
          const obj = JSON.parse(gens.result);
          console.log(gens);
          console.log(gens.result);
          ///const keys = Object.keys(obj);  // å–å‡ºæ‰€æœ‰éµ
          ///const values = Object.values(obj);  // å–å‡ºæ‰€æœ‰æ•¸å€¼

          smsg = xmsg;
          tmsg = obj[tlang];  ///obj.tlang;  ///
          imsg = obj[ilang];  ///obj.ilang;  ///
          console.log(smsg);
          console.log(tmsg);
          console.log(imsg);

          ///console.log(gens);
          ///const rmsg = gens; if (!gens) return;
          
          ///let smsg = await translate({ "text": gens, "source": rlang, "target": slang }); if (!smsg) return;   //OK
          ///const imsg = await translate({ "text": gens, "source": rlang, "target": ilang }); if (!imsg) return;  //OK
          ///smsg = xmsg; if (!smsg) return;  // é‚„åŸä½¿ç”¨è€…çš„èªè¨€

        } else {
          // é€™æ˜¯åŸæœ¬çš„ç¿»è­¯******  // é€²è¡Œç¿»è­¯**
          smsg = xmsg;
          tmsg = await translate({ "text": smsg, "source": slang, "target": tlang }); if (!tmsg) return;
          imsg = await translate({ "text": smsg, "source": slang, "target": ilang }); if (!imsg) return;
        }
        
        
        ///const randomID = "id_" + Math.random().toString(36).substring(2, 8);  // ç”¢ç”ŸçŸ­éš¨æ©Ÿ ID
        
        const nowUTC = new Date().toISOString();
        console.log(nowUTC);  // ä¾‹å¦‚ï¼š2025-06-14T09:22:30.123Z
        const hourUTC = new Date(nowUTC).getUTCHours();  // å–å¾— UTC å°æ™‚ï¼ˆ0-23ï¼‰
        
        const emoji_clock = EmojisClock[hourUTC];
        const emoji_textrl = 'ğŸ”„';
        const emoji_textil = 'ğŸ¤–';
        const emoji_textsl = 'ğŸ”£';
        const emoji_langxl = 'ğŸ‘„';  //ğŸ‘‚
        const result = (emoji_clock + nowUTC) + ("ğŸ”„" + imsg) + ("ğŸ¤–" + tmsg) + ("ğŸ”£" + smsg) + ("ğŸ‘„" + tlang + "|" + slang);/// + ("ğŸ†”" + randomID);  //???
        // ç©©å®šï¼šç™¼é€è¨Šæ¯
        ///channel.publish('message', result);
        
        // èªæ„è·é›¢
        const distance = await semantic({ "smsg": smsg, "rmsg": imsg }); // duguaynins/SemanticDistance
        console.log("èªæ„è·é›¢ï¼š" + distance + "***");

        // ä¸–ç•Œæ™‚é–“***  ///20260113
        const [times, offset] = updateTime();
        const ninsTimes = times + offset;
        
        // æ¸¬è©¦ï¼šçµ±ä¸€é¡¯ç¤ºèªæ„è·é›¢
        ///channel.subscribe
        channel.publish('message', {
          time: (emoji_clock + ninsTimes),
          rl_text: imsg, ///("ğŸ”„" + rmsg),
          il_text: tmsg, ///("ğŸ¤–" + imsg),
          sl_text: smsg, ///("ğŸ”£" + smsg),
          tl_lang: tlang, ///("ğŸ‘„" + ilang),
          sl_lang: slang, ///("ğŸ‘„" + slang),
          dist: distance, ///("ğŸ“" + distance),
        });
        
        
        // é¡¯ç¤ºæ¯”å°
        ///document.getElementById("SemanticDistance").textContent = "ï¼ˆ" + "ğŸ¯" + distance + "ï¼‰";
        ///input.placeholder = "ï¼ˆ" + "ğŸ‘„" + slang + ", " + "ğŸ¯" + distance + "ï¼‰";
        input.setAttribute("translate", "no");

        // é¡¯ç¤ºè¡¨å–®***
        // é å¡«ç¶²å€æ¨¡æ¿
        const baseURL = "https://docs.google.com/forms/d/e/1FAIpQLSdhEtDT6iin8qox8si8eWufXwCiDWNBjSr6AFGIQEfjoXjpIQ/viewform?usp=pp_url";

        // ç”¨æ¨¡æ¿å­—ä¸²ç”Ÿæˆå®Œæ•´ URL
        ///const var1 = ilang;
        ///const var2 = slang;
        ///const var3 = rlang;
        const var1 = tmsg;
        const var2 = smsg;
        const var3 = imsg;
        const var4 = distance;
        const var5 = uuid_user;
        const fullURL = `${baseURL}&entry.646913966=${encodeURIComponent(var1)}&entry.108198120=${encodeURIComponent(var2)}&entry.2008598079=${encodeURIComponent(var3)}&entry.1461710493=${encodeURIComponent(var4)}&entry.2108432241=${encodeURIComponent(var5)}`;
          
        // ç¶å®šæŒ‰éˆ•æ‰“é–‹è¡¨å–®
        const checkbox = document.getElementById("SkipForm");
        if (!checkbox.checked) {
            window.open(fullURL, "_blank", "noopener,noreferrer");
        } 
    }
    
    
    
    
    
    function isValid(str) {  ///20260116
      // null / undefined / ç©ºå­—ä¸² / åŒ…å«ç©ºç™½éƒ½ä¸åˆæ³•
      return str !== null && str !== undefined && !/\s/.test(str) && str !== "";
      console.log("space???");
    }
    
    // é€£ç·šå¾Œçš„ç¦ç”¨****
    // æ”¶åˆ°è¨Šæ¯æ™‚æ›´æ–°èŠå¤©å®¤  
    async function sendSocket() {      
        lastSentTime = Date.now();
    
        // å–æ¶ˆä»¥ä¸‹å…©è¡Œ
        ///document.getElementById('InputRoom').value = document.getElementById('InputRoom').value || "WORLD";
        ///document.getElementById('InputRoom').value = "WORLD";  // æš«æ™‚æ‰€æœ‰äººéƒ½å¿…é ˆä½¿ç”¨æ­¤  ///!!!
        
        document.getElementById('InputRoom').dispatchEvent(new Event('input')); // æ‰‹å‹•è§¸ç™¼äº‹ä»¶
        ///document.getElementById('barcodeSlider').value = 222;
        ///document.getElementById('barcodeSlider').dispatchEvent(new Event('input')); // æ‰‹å‹•è§¸ç™¼äº‹ä»¶
      
        ///const room = ("WORLD");  // ALL, BETA  ///!!!
        const buf_room = document.getElementById('InputRoom').value.split('&&')[0];  console.log(buf_room);
        const buf_apikey = document.getElementById('InputRoom').value.split('&&')[1];console.log(buf_apikey);
        let room = document.getElementById('InputRoom').value.split('&&')[0] || ("WORLD");  // ALL, BETA  ///!!!
        let apikey = document.getElementById('InputRoom').value.split('&&')[1] || ("");  // ALL, BETA  ///!!!
        let token = params.get("token") || ("nins");  ///!!!

        ///const room = room?.toLowerCase() ?? "";
        if ( !isValid(room) ) { 
            if (true) {
                document.querySelector('#chatbox').classList.add('textBlinkOnce');
                setTimeout(() => { document.querySelector('#chatbox').classList.remove('textBlinkOnce'); }, 1000);
                console.log("if ( !isValid(room) )"); 
                return;
            }
        }  ///20260116
        document.getElementById('InputRoom').value = room;
        room = room.toLowerCase();

        if (token==="nins") {  ///20260116            
            document.getElementById('InputRoom').disabled = true;  // å·²ç¦ç”¨
            document.getElementById('InputRoom').style.display = 'none';
            const email = room;
            const boolgo = await channels({ "email": email });
            console.log(boolgo);
            document.getElementById('InputRoom').style.display = '';
            document.getElementById('InputRoom').disabled = false;  // ä¸ç¦ç”¨
            if (!boolgo) { 
                document.querySelector('#chatbox').classList.add('textBlinkOnce');
                setTimeout(() => { document.querySelector('#chatbox').classList.remove('textBlinkOnce'); }, 1000);
                console.log("if (!boolgo)"); 
                return; 
            }
        }
        
        ///document.getElementById('InputRoom').value = ("WORLD");  ///!!!
        document.getElementById('InputRoom').disabled = true;  // ç¦ç”¨
        document.getElementById('InputRoom').style.display = 'none';
        ///!!!
        
        //*document.getElementById('SelectSlang').disabled = false;  // å•Ÿç”¨
        ///document.getElementById('SelectSlang').style.display = '';
        document.getElementById('SelectTlang').disabled = false;  // å•Ÿç”¨
        ///document.getElementById('SelectTlang').style.display = '';
        //*document.getElementById('Selectilang').disabled = false;  // å•Ÿç”¨
        ///document.getElementById('Selectilang').style.display = '';
        
        document.getElementById('chatbox').textContent = "";
        
        
        
        if (ably) {
            ably.close(); // Close existing connection if it exists
            ably = null;
        }
        if (!ably) {  ///!!!
            ///if (apikey_user) { ably = new Ably.Realtime({ key: apikey_user, clientId: uuid_user });console.log("apikey_user"); }
            ///if (!apikey_user) { ably = new Ably.Realtime({ key: apikey_nins, clientId: uuid_user });console.log("!apikey_user"); }
            
            
            
            if (apikey) {
                console.log("APIKEY: ", apikey);
                console.log("ROOM: ", room);
                ably = new Ably.Realtime({ key: apikey, clientId: uuid_user });console.log("apikey_user");
                
                if (false) {
                    apikey_user = "";
                    room = "WORLD";  // ä½¿ç”¨æˆ‘çš„é‡‘é‘°å¿…é ˆå›ºå®šé »é“
                    ///room = room;  // å»£ç‚ºäººçŸ¥å¾Œé–‹æ”¾è‡ªè¨‚æˆ¿é–“
                    // åªç™»å…¥è‡ªæœ‰çš„ä»¤ç‰Œ
                    updateQR();
                }
                else {
                    apikey_user = apikey;
                    room = room;
                    // å„²å­˜ä»¤ç‰Œ
                    ///fetch('http://localhost:7860/auth', {
                    fetch('https://duguaynins-RedirectAPI.hf.space/realtime/ably', {
                      method: 'POST',
                      headers: {
                        'clientId': uuid_user,
                        'Content-Type': 'application/json',
                        'Beta': `APIKEY ${apikey}`,
                        'Authorization': `Bearer ${0}`  // æˆ– 'TOEKN your_token'
                      },
                      body: JSON.stringify({ /* å¦‚æœéœ€è¦é€å…¶ä»–è³‡æ–™ï¼Œå¯æ”¾é€™è£¡ */ })
                    })
                    .then(response => response.json())
                    .then(data => {
                      console.log('å¾Œç«¯å›æ‡‰:', data);
                      
                      updateQR(data.token);
                    })
                    .catch(error => {
                      console.error('éŒ¯èª¤:', error);
                    });
                }
            }
            else if (token) {
                ///if (token === "nins") {  room = "WORLD"; document.getElementById('InputRoom').value = ("WORLD"); }
                console.log("TOKEN: ", token);
                console.log("ROOM: ", room);
                ///if (!document.getElementById('SkipAds').checked) { room = document.getElementById('InputRoom').value; }
                ///else { room = "WORLD"; document.getElementById('InputRoom').value = ("WORLD"); }
                console.log("TOKEN: ", token);
                console.log("ROOM: ", room);
                updateQR(token);
                ably = new Ably.Realtime({ authUrl: 'https://duguaynins-RedirectAPI.hf.space/realtime/ably', authMethod: 'POST', authHeaders: { 'clientId': uuid_user, 'Beta': `TOEKN ${token}`, 'Authorization': `Bearer ${0}` } });
            }
            
            
            
        }
        
        // åˆ¤æ–·é€£ç·šçµæœ
        if (ably) {
        ably.connection.on((stateChange) => {
        
          const state = document.getElementById('stateConnection');
          
          console.log('Connection changed from', stateChange.previous, 'to', stateChange.current);
        
          switch (stateChange.current) {
            case 'initialized':
              console.log('ğŸ“˜ Initialized: SDK instance created, not yet connecting.');
              state.textContent  = "ğŸ“˜ï¼ˆInitializedï¼‰";
              break;
            case 'connecting':
              console.log('ğŸ”£ Connecting: Attempting to establish a connection.');
              state.textContent  = "ğŸ”£ï¼ˆConnectingï¼‰";
              break;
            case 'connected':
              console.log('âœ… Connected: Successfully connected to Ably.');
              state.textContent  = "âœ…ï¼ˆConnectedï¼‰";

              document.getElementById('InputRoom').disabled = true;
              document.getElementById('InputRoom').style.display = 'none';
              ///document.getElementById('InputRoom').placeholder = '';

              document.getElementById('InputMsg').disabled = false;
              document.getElementById('InputMsg').style.display = 'block';
              break;
            case 'disconnected':
              console.log('âš ï¸ Disconnected: Connection is temporarily unavailable, retrying...');
              state.textContent  = "âš ï¸ï¼ˆDisconnectedï¼‰";

              document.getElementById('InputRoom').disabled = true;
              document.getElementById('InputRoom').style.display = 'none';
              ///document.getElementById('InputRoom').placeholder = '';

              document.getElementById('InputMsg').disabled = true;
              document.getElementById('InputMsg').style.display = 'none';
                  
              /*
              ably.close();  ///!!!
              document.getElementById("InputMsg").disabled = true;
              document.getElementById("ButtonMsg").disabled = true;
              document.getElementById("chatbox").style.backgroundColor = '#cdcdcd';
              ///document.getElementById("InputMsg").style.backgroundColor = '#cdcdcd';*/

              break;
            case 'suspended':
              console.log('â›” Suspended: Connection failed for too long. Will retry after a delay.');
              state.textContent  = "â›”ï¼ˆSuspendedï¼‰";
              break;
            case 'closing':
              console.log('ğŸ“´ Closing: Connection is being closed.');
              state.textContent  = "ğŸ“´ï¼ˆClosingï¼‰";
              break;
            case 'closed':
              console.log('ğŸ”’ Closed: Connection has been closed.');
              state.textContent  = "ğŸ”’ï¼ˆClosedï¼‰";
              break;
            case 'failed':
              console.log('âŒ Failed: Connection failed permanently. Manual intervention required.');
              state.textContent  = "âŒï¼ˆFailedï¼‰";
              if (stateChange.reason) {
                console.error('Reason:', stateChange.reason.message);
                state.textContent  = "âŒï¼ˆFailedï¼" + stateChange.reason.message + "ï¼‰";
              }
              break;
            default:
              console.log('Unknown connection state:', stateChange.current);
          }
        });
        }
        
        // ç‰¹æ®Šè²æ˜******
        const p = document.createElement("p");
        p.style.color = "red"; // å¯ä»¥ç”¨ CSS é¡è‰²åç¨±æˆ– HEX
        p.innerHTML  = `
              <p translate="no">âš ï¸Â© 2024 NINS. ğŸ‘»</p>
              <p>âš ï¸For your safety, only open files and links you sent yourself. ***</p>
              <p>âš ï¸Here, we are all representatives of humanity! ***</p>
              <p>âš ï¸To share and communicate as all humans rightly do. ***</p>
              <p>âš ï¸This service does not retain any records due to security reasons.</p>
              <p>âš ï¸This service provides limited translation capabilities due to being free of charge.</p>
              <p>âš ï¸For the best experience, please open this app using Google Chrome!</p>
              <p>âš ï¸Your language will change according to your browser language. ***</p>
              <p>âš ï¸...</p>
              <p>âš ï¸By using any of the services, it means you have agreed to any content and all content! ***</p>
              <p translate="no">âš ï¸Â© 2024 NINS. ğŸ‘»</p>
              `
        document.getElementById("chatbox").prepend(p);
        document.getElementById("chatbox").insertAdjacentHTML('afterbegin', '<div id="anchor"></div>');
          
        document.getElementById('InputRoom').disabled = true;  // ç¦ç”¨
        document.getElementById('InputRoom').style.display = 'none';
        document.getElementById('ButtonRoom').disabled = true;  // ç¦ç”¨
        document.getElementById('ButtonRoom').style.display = 'none';
        
        ///document.getElementById('InputMsg').disabled = false;  // å•Ÿç”¨
        ///document.getElementById('InputMsg').style.display = '';
        document.getElementById('ButtonMsg').disabled = false;  // å•Ÿç”¨
        document.getElementById('ButtonMsg').style.display = '';
        
        document.getElementById('ButtonMike').disabled = false;  // å•Ÿç”¨
        document.getElementById('ButtonMike').style.display = '';
        ///document.getElementById('BurronLink').disabled = false;  // å•Ÿç”¨
        ///document.getElementById('BurronLink').style.display = '';
        document.getElementById('chatbox').disabled = false;  // å•Ÿç”¨
        document.getElementById('chatbox').style.backgroundColor = '#ffffff';  //#cdcdcd
        
        ///document.getElementById('ButtonMsg').disabled = true;  // ç¦ç”¨
        document.getElementById('ButtonMsg').style.display = 'none';  // ä¸ç¦ç”¨ï¼Œä½†éš±è—
        
        const input = document.getElementById('InputRoom');
        const button = document.getElementById('ButtonRoom');
        ///const room = input.value;  // ALL, BETA  ///!!!
        channel = ably.channels.get(room);  // æ ¹æ“šæˆ¿é–“é€£ç·š
        input.value = room;
              
        // æ­£å¼é€²å…¥é »é“**
        channel.presence.enter();
        ///document.getElementById('DialogAds').showModal();startSkipAdsProgress();  ///test:20251221***ads

        // ç›£è½**
        ///channel.attach(() => {
        ///channel.presence.get((err, members) => {
        channel.presence.subscribe('enter', (member) => {
            // å–å¾—æ™‚é–“**
            const nowUTC = new Date().toISOString();
            const hourUTC = new Date(nowUTC).getUTCHours();  // å–å¾— UTC å°æ™‚ï¼ˆ0-23ï¼‰
            const emoji_clock = EmojisClock[hourUTC];
            const [times, offset] = updateTime();
            const ninsTimes = times;/// + offset;
            
            // ç´€éŒ„äº‹ä»¶**
            console.log(`${member.clientId} has entered.`);
            channel.presence.get((err, members) => {
              const p = document.createElement('p');
              p.innerHTML = `${emoji_clock}${ninsTimes}<br>ï¼ˆğŸŸ¢${member.clientId || 'USER'}ï¼‰`;p.style.color = 'green';
              p.setAttribute('translate', 'no');  //???
              ///document.getElementById("chatbox").prepend(p);
              ///document.getElementById("chatbox").insertBefore(p, document.getElementById("anchor"));
              document.getElementById('anchor').after(p);

              if (!err) { console.log('Members:', members.length);document.getElementById("copyright").innerHTML = `ğŸ‘»ï¼ˆ${room}, ${members.length}ï¼‰`; }
            });
            if (member.clientId === uuid_user) {
              document.getElementById("InputMsg").disabled = false;
              document.getElementById("InputMsg").style.display = '';
            }
        });
          
        channel.presence.subscribe('leave', (member) => {
            // å–å¾—æ™‚é–“**
            const nowUTC = new Date().toISOString();
            const hourUTC = new Date(nowUTC).getUTCHours();  // å–å¾— UTC å°æ™‚ï¼ˆ0-23ï¼‰
            const emoji_clock = EmojisClock[hourUTC];
            const [times, offset] = updateTime();
            const ninsTimes = times;/// + offset;
            
            // ç´€éŒ„äº‹ä»¶**
            console.log(`${member.clientId} has left.`);
            channel.presence.get((err, members) => {
              const p = document.createElement('p');
              p.innerHTML = `${emoji_clock}${ninsTimes}<br>ï¼ˆğŸ”´${member.clientId || 'USER'}ï¼‰`;p.style.color = 'red';
              p.setAttribute('translate', 'no');  //???
              ///document.getElementById("chatbox").prepend(p);
              ///document.getElementById("chatbox").insertBefore(p, document.getElementById("anchor"));
              document.getElementById('anchor').after(p);

              if (!err) { console.log('Members:', members.length);document.getElementById("copyright").innerHTML = `ğŸ‘»ï¼ˆ${room}, ${members.length}ï¼‰`; }
            });
            if (member.clientId === uuid_user) {
              document.getElementById("InputMsg").disabled = true;
              document.getElementById("InputMsg").style.display = 'none';
            }
        });
        
        
        
        // ç«‹å³è¨»å†Šè¨‚é–±ç›£è½
        ///channel.publish
        channel.subscribe('message', function(msg) {
          console.log("æ¥æ”¶åˆ°çš„è¨Šæ¯:", msg);
          
          // ç´€éŒ„æ–‡å­—ç”¨çš„å…ƒç´ ***
          const box = document.getElementById('chatbox');
          const p = document.createElement('p');
          ///p.textContent = msg.data;

          // åˆå§‹åŒ–**
          const obj = msg.data;
          // å–å¾—èªè¨€ä»£è™Ÿ**
          const msgtLangs = obj.sl_lang;
          const msgtLangm = obj.tl_lang;  // ä¸€èµ·å­¸ç¿’çš„èªè¨€
          const msgtLangr = "en";
          console.log("ğŸ‘„sl:", msgtLangs);
          console.log("ğŸ‘„il:", msgtLangm);
          console.log("ğŸ‘„rl:", msgtLangr);
          // å–å¾—åŸæ–‡èªè¨€**
          const msgtTexts = obj.sl_text;  ///smsg
          console.log("ğŸ”£sl", msgtTexts);
          // å–å¾—ä¸­é–“èªè¨€**
          const msgtTextm = obj.il_text;  ///imsg
          console.log("ğŸ”„il", msgtTextm);
          // å–å¾—å­¸ç¿’èªè¨€**  // é¡¯ç¤ºèªè¨€ï¼Ÿçµæœèªè¨€ï¼Ÿ
          const msgtTextr = obj.rl_text;  ///rmsg
          console.log("ğŸ¤–rl", msgtTextr);
          // å–å¾—æ™‚é–“**
          const msgTime = obj.time;
          console.log("ğŸ•›tm", msgTime);
          // å–å¾—è·é›¢**
          const msgDist = obj.dist;  ///distance
          console.log("ğŸ“ds", msgDist);  ///ğŸ¯

          
          // é¡¯ç¤ºçµæœ***
          ///const result = (index !== -1) ? msg.data.substring(0, index) : msg.data;
          // åŠ å…¥æ–‡å­—è½‰èªéŸ³æŒ‰éˆ•TTS**
          const randomID = "id_" + Math.random().toString(36).substring(2, 8);  // ç”¢ç”ŸçŸ­éš¨æ©Ÿ ID
          const functionName = `handleTTS_${randomID}`;  // å®šç¾©å°ˆå±¬å‡½å¼åç¨±
          
          
          // ç”¨æ¨¡æ¿å­—ä¸²ç”Ÿæˆå®Œæ•´ URL**
          const baseURL = "https://docs.google.com/forms/d/e/1FAIpQLSdhEtDT6iin8qox8si8eWufXwCiDWNBjSr6AFGIQEfjoXjpIQ/viewform?usp=pp_url";

          const var1 = msgtTextm;
          const var2 = msgtTexts;
          const var3 = msgtTextr;
          const var4 = msgDist;
          const var5 = uuid_user;
          const fullURL = `${baseURL}&entry.646913966=${encodeURIComponent(var1)}&entry.108198120=${encodeURIComponent(var2)}&entry.2008598079=${encodeURIComponent(var3)}&entry.1461710493=${encodeURIComponent(var4)}&entry.2108432241=${encodeURIComponent(var5)}`;
          
          // ç¶å®šæŒ‰éˆ•æ‰“é–‹è¡¨å–®
          const checkbox = document.getElementById("SkipForm");
          if (!checkbox.checked) {
              ///window.open(fullURL, "_blank", "noopener,noreferrer");
              ///window.open('${fullURL}', '_blank', 'noopener,noreferrer');
          } 
          
          // è¨˜éŒ„æ‰€æœ‰å¯èƒ½ä½¿ç”¨çš„è¡¨æƒ… EMOJIï¼šğŸ‘ï¸ğŸ”„ğŸ¤–ğŸ‘»ğŸ¯ğŸ“ğŸŸ¢ğŸ”´â›”

          // ä½¿ç”¨æ¨¡æ¿å­—ä¸²ï¼Œæ’å…¥ randomID åˆ° HTML å­—ä¸²ä¸­**
          ///const p = document.createElement('p');  // æ£„ç”¨æ­¤è¡Œ
          const div = document.createElement("div");
          div.innerHTML = `
            <span id="${randomID}_T" style="color:black;" translate="no">${msgTime}</span><br>
            <span style="color:black;">ï¼ˆ
            <label id="${randomID}_sl" translate="no" style="color:black;">ğŸ‘‚sl:${msgtLangs}<input style="display:none;" type="button" value="ğŸ‘‚${msgtLangs}" onclick="handleTTS('${randomID}_0')" /></label>
            <label id="${randomID}_tl" translate="no" style="color:black;">ğŸ‘‚tl:${msgtLangm}<input style="display:none;" type="button" value="ğŸ‘‚${msgtLangm}" onclick="handleTTS('${randomID}_1')" /></label>
            <label id="${randomID}_il" translate="no" style="color:black;">ğŸ‘‚il:${msgtLangr}<input style="display:none;" type="button" value="ğŸ‘‚${msgtLangr}" onclick="handleTTS('${randomID}_9')" /></label>
            ï¼‰</span>
            
            <p id="${randomID}_2" translate="no" style="display:block; color:gray;">ï¼ˆ ğŸ‘ï¸<span translate="yes">${msgtTextr}</span> ï¼‰</p>
            <p id="${randomID}_0" translate="no" style="display:none; color:gray;">ï¼ˆ ğŸ”£${msgtTexts}ğŸ‘„${msgtLangs} ï¼‰</p>
            <p id="${randomID}_1" translate="no" style="display:none; color:gray;">ï¼ˆ ğŸ¤–${msgtTextm}ğŸ‘„${msgtLangm} ï¼‰</p>
            <p id="${randomID}_9" translate="no" style="display:none; color:gray;">ï¼ˆ ğŸ‘»${msgtTextr}ğŸ‘„${msgtLangr} ï¼‰</p>

            <span style="color:gray;">ï¼ˆ
            <label id="${randomID}_ds" translate="no" style="color:gray;">ğŸ¯${msgDist}ğŸ“ds:${msgtLangr}&${msgtLangs}<input style="display:none;" type="button" value="ğŸ‘‚${0}" onclick="window.open('${fullURL}', '_blank', 'noopener,noreferrer')" /></label>
            ï¼‰</span>
          `;
          
          // æ·»åŠ ç´€éŒ„
          const anchor = document.getElementById('anchor');
          ///document.getElementById("chatbox").appendChild(p);  // å–æ¶ˆCCSæ™‚ï¼Œæ”¹ç”¨æ­¤ã€‚
          ///document.getElementById("chatbox").prepend(div); // åŠ åœ¨æœ€ä¸Šå±¤ï¼Œä½†å› ç‚º column-reverse æ˜¯ã€Œè¦–è¦ºåº•éƒ¨ã€ã€‚
          ///document.getElementById("chatbox").insertBefore(div, anchor);
          document.getElementById('anchor').after(div);

          // æ»¾å‹•ç´€éŒ„
          ///box.scrollTop = box.scrollHeight; 
          ///autoScroll();

          // å–å¾— select å…ƒç´ 
          var Playxlang = document.getElementById("Playxlang").value;

          // è®€å–é¸å–çš„æ–‡å­—
          ///var text = select.options[select.selectedIndex].text;
          if (Playxlang === "3") { document.getElementById(`${randomID}_sl`).click(); }
          if (Playxlang === "2") { document.getElementById(`${randomID}_tl`).click(); }
          if (Playxlang === "1") { document.getElementById(`${randomID}_il`).click(); }
          if (Playxlang === "0") {  }

          if (Playxlang === "") {  document.getElementById(`${randomID}_tl`).click(); 
                                   document.getElementById("Playxlang").value = "2";  }
          
        });
        
        
        // ç¬¬ä¸€æ¬¡åŠ å…¥èŠå¤©å®¤æ™‚***  // å·²ç¶“é¡¯ç¤ºåŠ å…¥è¨Šæ¯ï¼Œæ‰€ä»¥ä¸éœ€è¦é€™å€‹äº†
        ///document.getElementById("InputMsg").value = "I joined the " + room + " channel.";
        ///document.getElementById("ButtonMsg").click();
        document.getElementById("InputMsg").focus();
        ///box.scrollTop = box.scrollHeight; 
        autoScroll();
    }

    function autoScroll() {
        const chatBox = document.getElementById('chatbox');
        const anchor = document.getElementById('anchor');
        if (!chatBox || !anchor) return;

        const threshold = 100; // è·é›¢åº•éƒ¨ 100px ä»¥å…§æ‰è§¸ç™¼
        const isAtBottom = chatBox.scrollHeight - chatBox.scrollTop - chatBox.clientHeight <= threshold;

        if (true) {
            
            requestAnimationFrame(() => {
                chatBox.scrollTop = chatBox.scrollHeight;
                ///const anchorOffset = anchor.offsetTop - chatBox.offsetTop;
                ///chatBox.scrollTo({ top: anchorOffset, behavior: 'smooth' });
            });
        }
    }

    function languageScript(tag) {
      return tag.split('-').slice(0, 2).join('-');
    }
    function languageRegion(tag) {
      const match = tag.match(/^([^-]+)-([^-]+)$/); // å˜—è©¦åŒ¹é…å…©æ®µ
      if (match) return match[1] + '-' + match[2];
      
      // å¦‚æœæœ‰ä¸‰æ®µä»¥ä¸Šï¼Œå–ç¬¬ä¸€æ®µ + æœ€å¾Œä¸€æ®µ
      const parts = tag.split('-');
      if (parts.length >= 2) return parts[0] + '-' + parts[parts.length - 1];

      return tag; // åªæœ‰èªè¨€
    }
    
    function handleVoice(language) {
      // è¨­å®šé è¨­èªéŸ³
      ///if (!language) { language = languageRegion(navigator.language || navigator.userLanguage || "en-US"); }  ///20260116
      ///const language = languageRegion(navigator.language || navigator.userLanguage || "en-US");  // é–±è®€æ¯èª
      const voice = voices.filter(v => v.lang === language)[0] ||
                    ///voices.find(v => v.lang.startsWith( new URL(window.location.href).searchParams.get("lang")||language )) || 
                    ///voices.find(v => v.lang === language) || 
                    voices.find(v => v.lang.startsWith( language.replace(/_/g, "-") )) || // zh-TW
                    voices.find(v => v.lang.startsWith( language.replace(/-/g, "_") )) || // zh_TW
                    voices.find(v => v.lang.startsWith( language.slice(0, 2) ));
      ///const index = voices.indexOf(voice);
      ///const voice = voices[parseInt(voiceSelect.value)]
      console.log("handleVoice_inputs:", language);
      console.log("handleVoice_outputs:", voice.lang);
      return voice.lang;
    }
    
    // è™•ç†æ–‡å­—è½‰èªéŸ³****
    // çš„æŒ‰éˆ•é»æ“Šäº‹ä»¶****
    function handleTTS(id, select=[null,null,null]) {
        ///document.getElementById(id).style.display = "";
        const [selectId, selectText, selectAll] = select;

        
        if (document.getElementById(id).style.display === "none") {
            document.getElementById(id).style.display = "";
        }
        
        // ç§»é™¤å†åŠ ä¸Š classï¼Œç¢ºä¿æ¯æ¬¡é»æ“Šéƒ½èƒ½è§¸ç™¼å‹•ç•«
        document.getElementById(id).classList.remove('breathe');
        void document.getElementById(id).offsetWidth; // å¼·åˆ¶ reflow
        document.getElementById(id).classList.add('breathe');
    
        if (!("speechSynthesis" in window) || !("SpeechSynthesisUtterance" in window)) {
            ///alert("No TTS.")
            console.log("alert:", "No TTS.");
            ///alert("æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åˆæˆåŠŸèƒ½ï¼ˆTTSï¼‰ã€‚è«‹æ”¹ç”¨ Chrome æˆ– Safariã€‚");
            return;
        }
        if (!voices || voices.length === 0) {
            ///alert("No TTS voices.")
            console.log("alert:", "No Voices.");
            ///alert("èªéŸ³æ¸…å–®å°šæœªè¼‰å…¥ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
            return;
        }
        console.log("Voices loaded:", voices.length);
        
        // è£½ä½œæ–‡å­—è½‰èªéŸ³***
        // æ‰¾åˆ°æ–‡æœ¬**
        const input = document.getElementById("InputRate");
        const element = document.getElementById(id);
        const text = element.textContent;
        console.log("handleTTS_inputs", text);
        //if (element) { alert("å‰¯æ–‡å­—å…§å®¹ç‚ºï¼š " + element.textContent); }
        // å–å¾—èªè¨€**
        const index = text.lastIndexOf("ğŸ‘„");
        const before = text.substring(0, index);        // ğŸ‘„ å‰çš„å…§å®¹
        const after = text.substring(index + "ğŸ‘„".length); // ğŸ‘„ å¾Œçš„å…§å®¹ï¼ˆ+1ï¼‰
        // æ ¼å¼åŒ–**
        const content = before.substring(2 + "ğŸ”£".length);
        let language = after.substring(0, after.length - 1); language = handleVoice(language);   // æˆ– after = after.slice(0, -1);
        const talkrate = input.value;
        ///console.log("content:", content);
        ///console.log("language:", language);
        ///console.log("talkrate:", talkrate);
        console.log("handleTTS_outputs:", language, content, talkrate);
      
        // å–å¾—è²éŸ³
        ///const lang = tlang.slice(0, 2);
        const msg = new window.SpeechSynthesisUtterance();  // "ä½ å¥½ï¼Œæ­¡è¿ä½¿ç”¨èªéŸ³ç³»çµ±
        // ä¸è¨­å®š msg.langï¼Œçµæœä¸ä¸€å®šæ­£ç¢ºï¼ˆå¯èƒ½è®Šè‹±æ–‡è…”ï¼‰
        msg.text = selectText || content;  ///20260116
        msg.lang = language;           // èªè¨€ä»£ç¢¼
        msg.rate = talkrate;           // èªé€Ÿ 0.1 ~ 10
        msg.volume = 1;                // éŸ³é‡ 0~1
        msg.pitch = 1;                 // éŸ³é«˜ 0~2
        //msg.voice = voices[i];        // å¯é¸æ“‡èªéŸ³
        //msg.voice = window.speechSynthesis.getVoices()[0];
        //msg.voice = voices.find(v => v.lang === language) || voices.find(v => v.lang.startsWith(language.slice(0, 2)));  
        // voice å°è‡´ç¬¬ä¸€æ¬¡éé»˜èªæœƒå¤±æ•—ï¼Œå› æ­¤è¨»è§£ã€‚
        
        if (window.speechSynthesis.speaking) {
            window.speechSynthesis.cancel();    // âœ… æ¸…é™¤å…ˆå‰èªéŸ³ï¼Œé¿å…é˜»å¡**
            window.speechSynthesis.speak(msg);  // âœ… æ’­æ”¾èªéŸ³
        } else if (!speechSynthesis.speaking) {
            window.speechSynthesis.speak(msg);  // âœ… æ’­æ”¾èªéŸ³
        }

        // 20250805
        // è£½ä½œæ‹¼éŸ³
        // æ–°å¢åº«ï¼šsrc="https://cdn.jsdelivr.net/npm/pinyin-util@latest/dist/pinyin-util.min.js"
        if (document.getElementById(id).style.display === "none") {
            document.getElementById(id).style.display = "";
            // å¦‚æœæ˜¯éš±è—æ‰åŸ·è¡Œ
            if (language.slice(0, 2) === "ja") { }
            if (language.slice(0, 2) === "zh") {
                ///const pinyin = pinyinUtil.getPinyin(content, ' ', true);
                ///document.getElementById(id).innerHTML += "ï¼ˆ" + pinyin + "ï¼‰";
            }
        }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/pinyin-util@latest/dist/pinyin-util.min.js"></script>

  
    <script>
    // èªéŸ³è½‰æ–‡å­—
    let autoRestart = null;
    let recognition = null;
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) { recognition = new SpeechRecognition(); }
    
    if (!recognition) { 
        const button = document.getElementById("ButtonMike");
        button.textContent = "ğŸ™ï¸ï¼ˆBrowser not supportedï¼‰";
        button.disabled = true;
        ///return; 
    }
    if (recognition) {
    
        let finalTranscript = '';  // æœ€çµ‚çµæœ
        let interimTranscript = '';  // ä¸­é–“çµæœ
        
        let isRecognizing = null;
        const button = document.getElementById("ButtonMike");
        ///const recognition = new SpeechRecognition();        
        
        // ç›£è½é»æ“Š
        document.getElementById("ButtonMike").addEventListener("click", () => {
          if (button.textContent === "ğŸ™ï¸") { button.textContent = "ğŸ™ï¸ï¼ˆSTOPï¼‰"; }
          if (button.textContent === "ğŸ™ï¸ï¼ˆSTOPï¼‰") {
            
            
            // é¸æ“‡ä¸­é–“é¡¯ç¤ºï¼Œæ ¹æ“šè¨­å‚™
            if (isMobileDevice()) {
                ///console.log("ç›®å‰ç‚ºè¡Œå‹•è£ç½®ï¼Œä¸æ”¯æ´èªéŸ³è½‰æ–‡å­—çš„ä¸­é–“çµæœã€‚");
                ///alert("ç›®å‰ç‚ºè¡Œå‹•è£ç½®ï¼Œä¸æ”¯æ´èªéŸ³è½‰æ–‡å­—çš„ä¸­é–“çµæœã€‚");  ///âœ… ğŸ›‘
                recognition.interimResults = false; ///TEST
                recognition.continuous = true; ///TEST  ///BETA***
            }
            else {
                recognition.interimResults = true;  //OK
                recognition.continuous = true;  //OK
            }
            
            // é¸æ“‡èªè¨€
            if (!recognition.lang) {  // å£èªèªè¨€è¨­å®šåµæ¸¬  // å¿…é ˆ start() ä¹‹å‰
                ///recognition.lang = prompt("Input your speek language: (zh-TW || ja-JP || ko-KR || en-US)***") || tlang;
                recognition.lang = smike;  //tlang, slang  // è¦è¬›å…¶ä»–èªè¨€å°±è‡ªå·±æ›´æ›ç€è¦½å™¨èªè¨€å§ï¼ï¼ï¼  //???
            }
            
            button.textContent = "ğŸ™ï¸ï¼ˆKEEPï¼" + recognition.lang + "ï¼‰";
            recognition.start();
            autoRestart = true;
            
          } else {
            button.textContent = "ğŸ™ï¸ï¼ˆSTOPï¼‰";
            recognition.stop();
            autoRestart = false;
          }
        });
        
        // è½‰éŒ„é–‹å§‹***
        recognition.onstart = () => {
          console.log('è¾¨è­˜é–‹å§‹ï¼š', "~~~");
          button.textContent = "ğŸ™ï¸ï¼ˆKEEPï¼" + recognition.lang + "ï¼‰";
          if (autoRestart) {
              if (isMobileDevice()) { /*recognition.stop();recognition.start();*/ }  //OK
              else                  { /*recognition.stop();recognition.start();*/ }  //OK
          }
        };
        
        // è½‰éŒ„çµæŸ***
        recognition.onend = () => {
          console.log('è¾¨è­˜åœæ­¢ï¼š', "~~~");
          button.textContent = "ğŸ™ï¸ï¼ˆSTOPï¼‰";
          if (autoRestart) {
              if (isMobileDevice()) { recognition.stop();recognition.start(); }  //OK
              else                  { recognition.stop();recognition.start(); }  //OK
          }
        };
        
        // è½‰éŒ„éŒ¯èª¤***
        recognition.onerror = (event) => {
          console.error('è¾¨è­˜éŒ¯èª¤ï¼š', event.error);
          ///alert(event.error);
          
          if (event.error === "no-speech") {
            console.log("é‡æ–°å•Ÿå‹•è¾¨è­˜ä¸­...");
            autoRestart = true; 
            
            // é›–ç„¶ä¼¼ä¹æœƒè‡ªå‹•é‡æ–°å•Ÿå‹•
            ///recognition.stop();recognition.start();  // stop(); æˆ– abort();  // è‡ªå‹•é‡å•Ÿï¼Œåªè¦ä¸æ˜¯ä½¿ç”¨è€…æ‰‹å‹•æŒ‰ã€Œåœæ­¢ã€
            
            button.textContent = "ğŸ™ï¸ï¼ˆKEEPï¼" + recognition.lang + "ï¼‰";  //???
            ///!!!
          } else { 
            console.log("åœæ­¢éŒ¯èª¤è¾¨è­˜ä¸­...");
            autoRestart = false; 
            
            // ä¸é‡å•ŸéŒ„éŸ³
            
            button.textContent = "ğŸ™ï¸ï¼ˆERRORï¼" + event.error + "ï¼‰";
            ///setTimeout(() => button.textContent = "ğŸ™ï¸ï¼ˆERRORï¼" + event.error + "ï¼‰", 1000);  // æ–¹ä¾¿é–±è®€
            ///setTimeout(() => null, 1000);  // æ–¹ä¾¿é–±è®€
            ///setTimeout(() => recognition.abort(), 1000); // è‡ªå‹•é—œé–‰
            
          }  // "network", "no-allowed"
        };
        
        
        
        // è½‰éŒ„çµæœ***
        recognition.onresult = (event) => {
          interimTranscript = '';
          finalTranscript = '';  // éœ€è¦å®šæœŸæ¸…é™¤æ™‚ï¼Œé–‹å•Ÿï¼
          
          for (let i = event.resultIndex; i < event.results.length; ++i) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
              const result = (interimTranscript || transcript) + '...';  // æ‰‹æ©Ÿä¸æ”¯æ´ä¸­é–“çµæœ
              finalTranscript = result + finalTranscript;
              // å¯ä»¥è®“é›™ç«¯é¡¯ç¤ºï¼
              if (isMobileDevice()) { document.getElementById("InputMsg").value = finalTranscript.trim(); }
              else                  { document.getElementById("InputMsg").value = finalTranscript.trim(); }
              
              ///translate(result, recognition.lang, tlang);  // ç¿»è­¯
              ///sendMessage();
              ///document.getElementById("InputMsg").focus();
              ///document.getElementById("InputMsg").value += " ";
              ///document.getElementById("ButtonMsg").click();
              // å¦‚ä½•è®“é›™ç«¯å‚³é€ï¼Ÿ
              if (isMobileDevice()) { sendMessage(); /*document.getElementById("ButtonMsg").click();*/ /*document.getElementById("InputMsg").focus();*/ }
              else                  { sendMessage(); /*document.getElementById("ButtonMsg").click();*/ }  // è¬›è€…å¯ä»¥æŒ‰éˆ•å‚³é€
              
            } else {
              const result = (transcript) + '...\n';
              interimTranscript += transcript;  // æˆ– interimTranscript + transcript + '\n';  // å°‡ä¸­é–“çµæœ()
              
              ///translate(interimTranscript.trim(), 'auto', 'auto');  // ç¿»è­¯
              // å¦‚ä½•è®“æ‰‹æ©Ÿé¡¯ç¤ºï¼Ÿ
              if (isMobileDevice()) { document.getElementById("InputMsg").value = interimTranscript.trim(); }
              else                  { document.getElementById("InputMsg").value = interimTranscript.trim(); }
            }
          }
          ///document.getElementById("InputMsg").value = finalTranscript.trim();  // åˆ†åˆ¥æ’å…¥ä¸­é–“èˆ‡çµæœ
          ///document.getElementById("ButtonMsg").click();  // åˆ†åˆ¥æ’å…¥ä¸­é–“èˆ‡çµæœ
        };
    }
    </script>
    
  
    <script>
    ///20250622
    // æ±ºå®šè¿½åŠ çš„èªè¨€
    ///window.onload = function() {
    document.addEventListener('DOMContentLoaded', () => {
        const news = document.createElement("option");        
        news.value = xlang;///this.options[this.selectedIndex].value;///this.value;
        news.text = "auto*";///this.options[this.selectedIndex].text;///this.text;
        document.getElementById("SelectSlang").appendChild(news);
        news.selected = true;  // âœ… è¨­ç‚ºé è¨­é¸ä¸­
        
        const newi = document.createElement("option");
        newi.value = xlang;///this.options[this.selectedIndex].value;///this.value;
        newi.text = "auto*";///this.options[this.selectedIndex].text;///this.text;
        document.getElementById("SelectTlang").appendChild(newi);
        newi.selected = true;  // âœ… è¨­ç‚ºé è¨­é¸ä¸­
    });  // è¼‰å…¥ç›£è½
    ///};
    
    document.getElementById("SelectSlang").addEventListener("change", function () {
        if (true) { 
            const selectedValue = this.value;
            slang = selectedValue;  // è¼¸å…¥çš„èªè¨€
            console.log("é¸æ“‡äº†ï¼š", selectedValue);
            autoRestart = false;  ///!!!
        }

        if (!recognition) { }
        if (recognition) {  ///!!!
            
            recognition.lang = slang;
            ///recognition.stop();recognition.start();

            recognition.stop();  ///!!!
            document.getElementById("ButtonMike").textContent = "ğŸ™ï¸ï¼ˆSTOPï¼‰";  ///!!!
        }
    });
    
    document.getElementById("SelectTlang").addEventListener("change", function () {
        const selectedValue = this.value;
        tlang = selectedValue;  // å­¸ç¿’çš„èªè¨€
        console.log("é¸æ“‡äº†ï¼š", selectedValue);
        
        ///const news = document.createElement("option");
        ///news.value = this.options[this.selectedIndex].value;///this.value;
        ///news.text = this.options[this.selectedIndex].text;///this.text;
        ///document.getElementById("SelectSlang").appendChild(news);
        // é€™è£¡å¯ä»¥åŠ å…¥å…¶ä»–é‚è¼¯ï¼Œä¾‹å¦‚æ ¹æ“šé¸æ“‡æ›´æ”¹èªè¨€ã€é¡¯ç¤ºè¨Šæ¯ç­‰
    });
    
    // é¬¼é¬¼é€Ÿåº¦ï¼ï¼ï¼
    document.getElementById('InputSpeed').addEventListener('input', function () {
        speed = this.value;  // âœ… this æ˜¯ input å…ƒç´ 
    });
    </script>
    <script>
    ///20220623
    // äº’å‹•å¼æª”æ¡ˆä¸‹è¼‰
    function downloadHTML(filename) {
      // è¤‡è£½ä¸€ä»½å®Œæ•´ HTML
      const clone = document.documentElement.cloneNode(true);

      // ç§»é™¤æ‰€æœ‰ <script> æ¨™ç±¤
      ///clone.querySelectorAll('script').forEach(el => el.remove());
      clone.querySelectorAll("script").forEach(s => {
        if (s.textContent.includes("DOMContentLoaded")) {
          const text = s.textContent;
          if (text.includes("è¦–çª—é«˜åº¦")) { s.remove(); }
          ///s.remove();
        }
      });

      // æ’å…¥ä½ æƒ³ä¿ç•™çš„ JS æ–¹æ³•ï¼ˆæ–°å¢ handleTTS å‡½å¼ï¼‰
      const ttsScript = document.createElement("script");
      ttsScript.textContent = `
        ///function handleTTS(id, lang = "") {}
      `;
      clone.querySelector("body").appendChild(ttsScript);

      // çµ„åˆæˆå®Œæ•´ HTML
      const dt = document.doctype;
      const doctypeStr = dt ? "<!DOCTYPE " + dt.name + ">\n" : "";
      const html = doctypeStr + clone.outerHTML;

      // å»ºç«‹ä¸¦ä¸‹è¼‰
      const blob = new Blob([html], { type: "text/html;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    // æ–‡å­—æª”æ¡ˆä¸‹è¼‰
    function downloadTXT(filename) {
      ///const chatContent = document.getElementById("chatbox").innerText;  // displayä¸è¢«è®€å–***
      const chatContent = document.getElementById("chatbox").textContent;
      ///const blob = new Blob([chatContent], { type: "text/plain;charset=utf-8" });
      // OR 
      const BOM = "\uFEFF";  // åŠ å…¥ UTF-8 BOM è§£äº‚ç¢¼
      const blob = new Blob([BOM + chatContent], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      
      // æ™‚é–“****
      const nowUTC = new Date().toISOString();
      const filetimestamp = nowUTC.replace(/[-:.]/g, '_');
      console.log(filetimestamp); // ä¾‹å¦‚ï¼š2025-07-02T06-56-31-400Z
      
      // æª”æ¡ˆåç¨±****
      const a = document.createElement("a");
      a.href = url;
      ///a.download = uuid_user + ".txt";
      ///a.download = "NINS_TRANSING_" + filetimestamp + ".txt";
      a.download = filename;
      
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);


    }

    // æª”æ¡ˆä¸‹è¼‰
    function DOWNLOAD() {
      // æ™‚é–“****
      const nowUTC = new Date().toISOString();
      const filetimestamp = nowUTC.replace(/[-:.]/g, '_');
      console.log(filetimestamp); // ä¾‹å¦‚ï¼š2025-07-02T06-56-31-400Z
      const filename = "NINS_TRANSING_" + filetimestamp;

      downloadTXT(filename + ".txt");
      downloadHTML(filename + ".html");
    }

    function DUGUAYNINS() {
      window.open("https://jpgt.xyz/", "_blank", "noopener,noreferrer");
    }
    function COPYRIGHT() {
      ///window.open("https://copyright.nins.cc/children/transing?", "_blank", "noopener,noreferrer");
      window.open("https://copyright.nins.cc/children/transing-il-en?", "_blank", "noopener,noreferrer");
    }
      
    </script>
    
    <!--script src="copyright.js"></script-->
    <!--script>
    /*
      ///20240915-0000
      // å»ºç«‹ç‰ˆæ¬Šæ–‡å­—å…ƒç´ 
      const copyright = document.createElement("div");
      copyright.textContent = "Â© 2024 NINS.";
      copyright.textContent = "ğŸ‘»";
      
      // è¨­å®šæ¨£å¼
      Object.assign(copyright.style, {
        position: "fixed",
        top: "0px",
        left: "0px",
        padding: "5px 10px",
        backgroundColor: "rgba(0,0,0,0.5)",
        color: "#fff",
        /*fontSize: "14px",*/
        borderRadius: "4px",
        pointerEvents: "none",  // ä¸é˜»æ“‹é»æ“Š
        userSelect: "none",     // ä¸å¯é¸å–æ–‡å­—
        zIndex: "9999"
      });
    
      // åŠ å…¥é é¢
      document.body.appendChild(copyright);
    
      // è‡ªå‹•ç§»å‹•åƒæ•¸
      let x = 0, y = 0;
      let dx = 1, dy = 1;
      ///const speed = 1.2;
    
      function animate() {
        const maxX = window.innerWidth - copyright.offsetWidth;
        const maxY = window.innerHeight - copyright.offsetHeight;
    
        x += dx * speed;
        y += dy * speed;
    
        if (x <= 0 || x >= maxX) dx *= -1;
        if (y <= 0 || y >= maxY) dy *= -1;
    
        copyright.style.left = x + "px";
        copyright.style.top = y + "px";
    
        requestAnimationFrame(animate);
      }
    
      animate();
    */
    </script-->
    <script type="text/javascript">
      // GOOGLE TRANSLATE
      // è‡ªå‹•ç¿»è­¯***
      ///document.cookie = "googtrans=/en/zh-TW; path=/";
      ///location.reload();
    
      function googleTranslateElementInit() {
        new google.translate.TranslateElement({
          pageLanguage: 'en',  ///'en', ilang, æ”¹ç‚ºæ ¹æ“šä¸­é–“èªè¨€  ///é¼“å‹µè¼¸å…¥ä¸­é–“èªè¨€ï¼Œç¿»è­¯å¿…å®šå¯ä»¥é¡¯ç¤ºè‹±æ–‡ã€‚
          includedLanguages: '',  ///zh-TW,ja,ko,en,hi,zh-CN
          autoDisplay: true,
          ///layout: google.translate.TranslateElement.InlineLayout.SIMPLE
        }, 'google_translate_element');
      }

      function waitForCombo(callback) {
        /*é€™æ˜¯ä¸€ç¨®èª¿ç”¨æ–¹æ³•ï¼Ÿ ä¸¦ä¸”ä½¿ç”¨æ–¹æ³•çš„å…§éƒ¨è®Šæ•¸ï¼Ÿ */
        const timer = setInterval(() => {
          const combo = document.querySelector('.goog-te-combo');
          if (combo) {
            clearInterval(timer);
            callback(combo);
          }
        }, 300);
      }

      function waitForTranslationById(elementId, callback) {
        const target = document.getElementById(elementId);
        if (!target) return;

        const observer = new MutationObserver((mutations, obs) => {
          for (const mutation of mutations) {
            // åµæ¸¬å­ç¯€é»æˆ–æ–‡å­—å…§å®¹æ˜¯å¦æ”¹è®Š
            if (mutation.type === "childList" || mutation.type === "characterData") {
              obs.disconnect(); // ç¿»è­¯å®Œæˆï¼Œåœæ­¢è§€å¯Ÿ
              callback();
              break;
            }
          }
        });

        observer.observe(target, {
          childList: true,   // å­ç¯€é»å¢æ¸›
          subtree: true,     // åŒ…å«æ‰€æœ‰å­å­«ç¯€é»
          characterData: true // æ–‡å­—å…§å®¹æ”¹è®Š
        });
      }
    
      function autoTranslate(lang) {
        const tryTranslate = () => {
          const combo = document.querySelector('.goog-te-combo');
          console.log('combo?', !!combo);
            
          if (lang.replace(/_/g, "-").split("-")[0] === "en") {
            document.getElementById('InputRoom').disabled = false;
            document.getElementById('InputRoom').style.display = 'block';
            ///document.getElementById('InputRoom').textAlign = 'center';
          }
      
          waitForTranslationById('notice', () => {
            document.getElementById('InputRoom').disabled = false;
            document.getElementById('InputRoom').style.display = 'block';
            ///document.getElementById('InputRoom').textAlign = 'center';
          });

          if (!combo) { 
            console.log("combo:-1"); setTimeout(tryTranslate, 300);return;
          }
          ///if (combo) {  /// && combo.options.length > 0
          ///if (combo && combo.options.length > 0) {
          if (!(combo && combo.options.length > 0)) {
            console.log("combo: 0"); setTimeout(tryTranslate, 300);return;
          } else { 
            console.log("combo:+1"); 
            const options = Array.from(combo.options).map(opt => opt.value);console.log('å¯ç”¨èªè¨€ä»£ç¢¼:', options);
            
            console.log("autoTranslate?:", lang);
            document.querySelector('.goog-te-combo').addEventListener('change', () => {
              console.log("èªè¨€å·²åˆ‡æ›!");
              console.log("æ–°èªè¨€ä»£ç¢¼:", combo.value);
              ///console.log("æ–°èªè¨€æ–‡å­—:", combo.options[combo.selectedIndex].text);
            });

            
            ///combo.value = lang;
            combo.value = options.includes(lang) 
              ?  lang 
              :  options.find(opt => opt.startsWith(lang))  
              || options.find(opt => opt.startsWith(lang.slice(0, 2))) 
              || null;
            combo.dispatchEvent(new Event('change'));
            console.log("autoTranslate!:", combo.value);
            
            ///document.getElementById('InputRoom').disabled = false;
            ///document.getElementById('InputRoom').style.display = 'block';
            ///document.getElementById('InputRoom').textAlign = 'center';

            /*
            if (options.includes(lang)) {
              console.log("translate: ", lang);
              combo.value = lang;
              combo.dispatchEvent(new Event('change'));
            } else if (options.includes(lang.split('-')[0])) {
              console.log("translate: ", lang.split('-')[0]);
              combo.value = lang.split('-')[0];
              combo.dispatchEvent(new Event('change'));
            } else {
              console.log("translate: ", "null");
              ///combo.value = "zh-TW";
              ///combo.dispatchEvent(new Event('change'));
            }  */

          } ///else { setTimeout(tryTranslate, 300);console.log(); }
        };
        tryTranslate();
      }
    
      window.addEventListener('load', () => {
        console.log("window...load");
          
        waitForCombo((combo) => {
          console.log("autoTranslate...waitForCombo");
          autoTranslate( slang || (navigator.language || navigator.userLanguage || "en-US") );
          ///console.log("combo å·²ç”Ÿæˆ:", combo);
          ///combo.value = 'en';
          ///combo.dispatchEvent(new Event('change'));
        });
        /*
        setTimeout(() => {
          console.log("autoTranslate...setTimeout");
          ///const slang = navigator.language || navigator.userLanguage || "en-US";
          autoTranslate( (navigator.language || navigator.userLanguage || "en-US") );          
          ///document.getElementById(":1.container").style.display = "";
        }, 1000); */
      });
    </script>
    
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    
    <script>
    // åˆå§‹åŒ–ï¼šé»˜èªæƒæé€£ç·š
    function autoConnect() {
        ///channel = params.get("channel");
        document.getElementById('InputRoom').value = params.get("channel");
        if ( params.get("channel") ) { sendSocket(); }
        ///document.getElementById('chatbox').textContent = "";  // æ­¤è¡Œæ”¾ç½®æ–¼ sendSocket() å…§éƒ¨ï¼
    }
    
    document.addEventListener('DOMContentLoaded', function () {
        setTimeout(() => autoConnect(), 2500); // è‡ªå‹•é€£ç·š  1000~3000
    });
    </script>
</body>
</html>

